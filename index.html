<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>251KENO - Telegram Mini App</title>
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Chapa Payment SDK -->
    <script src="https://js.chapa.co/v1"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Prevent zoom on mobile */
        input, select, textarea {
            font-size: 16px !important;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background gradient */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            opacity: 0.1;
            z-index: -1;
        }

        /* Container */
        .app-container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 0;
        }

        /* Header - Beautiful Design */
        .header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, rgba(18, 18, 18, 0.98) 0%, rgba(30, 30, 30, 0.95) 100%);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
            padding: 10px 16px;
            min-height: 60px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
            height: 100%;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 180, 219, 0.3);
        }

        .logo-text {
            background: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 18px;
            font-weight: 700;
        }

        .balance-section {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%);
            padding: 8px 14px;
            border-radius: 18px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.1);
        }

        .balance-icon {
            font-size: 18px;
            filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.5));
        }

        .balance-amount {
            color: #ffffff;
            font-size: 15px;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .music-indicator {
            font-size: 14px;
            animation: musicPulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 4px rgba(64, 192, 87, 0.5));
        }

        @keyframes musicPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .deposit-btn {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 180, 219, 0.4);
        }

        .deposit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 180, 219, 0.5);
        }

        .deposit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .deposit-btn:hover::before {
            left: 100%;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 36px;
            height: 36px;
            padding: 0;
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .logout-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 8px;
            padding-bottom: 100px;
            width: 100%;
            max-width: 100vw;
        }

        /* Game Title */
        .game-title {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-title h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .game-title p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        /* Number Grid */
        .number-grid-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 6px;
            margin: 0 4px 16px 4px;
            width: calc(100% - 8px);
            max-width: 100vw;
            overflow: hidden;
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .grid-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .selected-count {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            width: 100%;
            padding: 6px;
            max-width: 100vw;
        }

        .number-btn {
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 10px;
            font-weight: 700;
            font-size: clamp(10px, 3vw, 14px);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 32px;
            min-width: 32px;
        }

        .number-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .number-btn:active::before {
            width: 100px;
            height: 100px;
        }

        .number-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .number-btn.default {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .number-btn.default:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .number-btn.selected {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            color: white;
            border-color: rgba(0, 180, 219, 0.5);
            box-shadow: 0 4px 15px rgba(0, 180, 219, 0.4);
            animation: pulse 2s infinite;
        }

        .number-btn.drawn {
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            color: white;
            border-color: rgba(255, 81, 47, 0.5);
            box-shadow: 0 4px 15px rgba(255, 81, 47, 0.4);
        }

        .number-btn.matched {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.6);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }
        }

        /* Live Bets Section */
        .live-bets-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 16px;
            max-height: 200px;
            overflow: hidden;
        }

        .live-bets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .live-bets-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse-live 2s infinite;
        }

        @keyframes pulse-live {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .live-count {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .live-bets-feed {
            max-height: 450px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .live-bet-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin-bottom: 4px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeInBet 0.5s ease forwards;
            border-left: 3px solid transparent;
        }

        .live-bet-item.new {
            border-left-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        @keyframes fadeInBet {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bet-avatar {
            font-size: 18px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .bet-player {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            min-width: 0;
            flex: 1;
        }

        .bet-amount {
            color: #FFD700;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            white-space: nowrap;
        }

        /* Custom scrollbar for live bets */
        .live-bets-feed::-webkit-scrollbar {
            width: 4px;
        }

        .live-bets-feed::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .live-bets-feed::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .live-bets-feed::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Community Section Styles */
        .community-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .tab-navigation {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 4px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            position: relative;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 180, 219, 0.3);
            transform: translateY(-1px);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .tab-content {
            padding: 16px;
            min-height: 400px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Live Bets specific styles (adjusted) */
        .live-bets-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 12px;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            max-height: 450px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .leaderboard-table {
            width: 100%;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 4px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            font-size: 14px;
            border-left: 3px solid transparent;
            animation: fadeInBet 0.5s ease forwards;
        }

        .leaderboard-item.top-5 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%);
            border-left-color: #FFD700;
            position: relative;
            overflow: hidden;
        }

        .leaderboard-item.top-5::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .leaderboard-rank {
            font-weight: 700;
            color: #FFD700;
            min-width: 24px;
            text-align: center;
        }

        .leaderboard-player {
            flex: 1;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            margin-left: 8px;
        }

        .leaderboard-player.top-5 {
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            font-weight: 700;
        }

        .leaderboard-amount {
            color: #22c55e;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(34, 197, 94, 0.3);
        }

        /* Results Styles */
        .results-container {
            max-height: 450px;
            overflow-y: auto;
        }

        .section-title {
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .numbers-balls {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 12px;
        }

        .result-ball {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .result-ball.winning {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
        }

        .result-ball.losing {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .winners-feed {
            max-height: 80px;
            overflow-y: auto;
        }

        .winner-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            margin-bottom: 2px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            font-size: 12px;
            opacity: 0;
            animation: fadeInWinner 0.5s ease forwards;
        }

        @keyframes fadeInWinner {
            to {
                opacity: 1;
            }
        }

        .winner-avatar {
            font-size: 14px;
        }

        .winner-name {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            flex: 1;
        }

        .winner-amount {
            color: #FFD700;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        /* Custom scrollbars */
        .leaderboard-container::-webkit-scrollbar,
        .results-container::-webkit-scrollbar,
        .winners-feed::-webkit-scrollbar {
            width: 4px;
        }

        .leaderboard-container::-webkit-scrollbar-track,
        .results-container::-webkit-scrollbar-track,
        .winners-feed::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .leaderboard-container::-webkit-scrollbar-thumb,
        .results-container::-webkit-scrollbar-thumb,
        .winners-feed::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 6px;
            margin: 0 4px 12px 4px;
            width: calc(100% - 8px);
        }

        .quick-action-btn {
            flex: 1;
            padding: 10px 8px;
            border: none;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.15);
            min-height: 36px;
        }

        .quick-action-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        }

        .quick-action-btn.auto-pick {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            border: none;
            box-shadow: 0 2px 8px rgba(0, 180, 219, 0.3);
            color: white;
        }

        .quick-action-btn.auto-pick:hover {
            box-shadow: 0 4px 12px rgba(0, 180, 219, 0.4);
        }

        /* Betting Section */
        .betting-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 12px;
            margin: 0 4px 12px 4px;
            width: calc(100% - 8px);
        }

        .bet-control {
            margin-bottom: 10px;
        }

        .bet-label {
            color: white;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-amount-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 6px 10px;
        }

        .bet-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bet-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .bet-amount-display {
            color: white;
            font-weight: 700;
            font-size: 16px;
            min-width: 70px;
            text-align: center;
        }

        .bet-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            margin-top: 6px;
        }

        .bet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(255, 81, 47, 0.4);
        }

        .risk-select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .risk-select option {
            background: #1a1a1a;
            color: white;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .risk-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-low {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .risk-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .risk-high {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .balance-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .play-button-container {
            display: flex;
            gap: 8px;
        }

        .play-btn {
            flex: 2;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .play-btn.ready {
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(255, 81, 47, 0.4);
            animation: pulse-glow 2s infinite;
        }

        .play-btn.ready:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 81, 47, 0.5);
        }

        .play-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            box-shadow: none;
            cursor: not-allowed;
            animation: none;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 4px 20px rgba(255, 81, 47, 0.4);
            }

            50% {
                box-shadow: 0 4px 30px rgba(255, 81, 47, 0.6);
            }
        }





        .action-btn {
            flex: 1;
            padding: 8px 6px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.15);
            min-height: 4028px;
            letter-spacing: 0.5px;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(255, 255, 255, 0.1);
        }

        /* History Button */
        .history-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 180, 219, 0.4);
            transition: all 0.3s ease;
            z-index: 40;
        }

        .history-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 180, 219, 0.5);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 20px;
            max-width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
            width: 100%;
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Deposit Modal Specific Styles */
        #deposit-modal {
            display: none;
            opacity: 1;
            visibility: visible;
        }

        #deposit-modal.show {
            display: flex !important;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .payment-method:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: #15aabf;
            background: rgba(21, 170, 191, 0.2);
        }

        .payment-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .payment-method div {
            color: white;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }

        .tab-button {
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tab-button.active {
            opacity: 1 !important;
        }

        /* Header button styles - Beautiful Design */
        .header-btn {
            min-width: 80px;
            height: 42px;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .header-btn:active {
            transform: translateY(0);
        }

        .btn-icon {
            font-size: 16px;
        }

        .btn-text {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .deposit-btn {
            background: linear-gradient(135deg, #d49639, #881fae);
            border: 1px solid rgba(64, 192, 87, 0.3);
        }

        .deposit-btn:hover {
            background: linear-gradient(135deg, #37b24d, #1e7e34);
            border-color: rgba(64, 192, 87, 0.5);
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .login-btn {
            background: linear-gradient(135deg, #15aabf, #1098f7);
            border: 1px solid rgba(21, 170, 191, 0.3);
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #1098f7, #0c7cd5);
            border-color: rgba(21, 170, 191, 0.5);
        }

        /* User info styles for new header */
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #15aabf, #1098f7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .user-info span {
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        .login-btn {
            background: linear-gradient(135deg, #15aabf, #1098f7);
            margin-right: 10px;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #1098f7, #0c7cd5);
            transform: translateY(-1px);
        }

        /* Settings Modal Styles */
        .settings-modal {
            display: none;
        }

        .settings-content {
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .user-avatar-large {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #15aabf, #1098f7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }

        .user-name-large {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .user-status {
            color: #40c057;
            font-size: 12px;
        }

        .settings-login-prompt {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .login-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .login-text {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
        }

        .settings-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-item-title {
            color: white;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .settings-item-desc {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .settings-arrow {
            color: rgba(255, 255, 255, 0.5);
            font-size: 20px;
            font-weight: bold;
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #40c057;
        }

        .toggle-slider {
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .settings-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .login-settings-btn {
            background: linear-gradient(135deg, #15aabf, #1098f7);
            color: white;
        }

        .login-settings-btn:hover {
            background: linear-gradient(135deg, #1098f7, #0c7cd5);
            transform: translateY(-1px);
        }

        .logout-settings-btn {
            background: linear-gradient(135deg, #f03e3e, #c92a2a);
            color: white;
        }

        .logout-settings-btn:hover {
            background: linear-gradient(135deg, #c92a2a, #a61e1e);
            transform: translateY(-1px);
        }

        .settings-logout {
            text-align: center;
        }

        /* Contact Modal Styles */
        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .contact-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .contact-title {
            color: white;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .contact-detail {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        /* Fair Play Modal Styles */
        .fairplay-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .fairplay-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .fairplay-title {
            color: white;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .fairplay-detail {
            color: #40c057;
            font-size: 14px;
        }


        /* Drawing Animation */
        .drawing-animation {
            text-align: center;
        }

        .current-draw {
            margin-bottom: 24px;
        }

        .draw-counter {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .drawn-ball {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin: 0 auto;
            box-shadow: 0 8px 25px rgba(255, 81, 47, 0.5);
            animation: bounce 1s infinite;
        }

        .drawn-ball.matched {
            background: linear-gradient(135deg, #22c55e 0%, #FFD700 50%, #FFA500 100%);
            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.6), 0 0 20px rgba(255, 215, 0, 0.4);
            animation: bounce-glow 1s infinite;
        }

        .drawn-ball.countdown {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.6);
            animation: pulse-red 1s infinite;
        }

        @keyframes bounce-glow {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0) scale(1);
                box-shadow: 0 8px 30px rgba(34, 197, 94, 0.6), 0 0 20px rgba(255, 215, 0, 0.4);
            }

            40% {
                transform: translateY(-15px) scale(1.1);
                box-shadow: 0 12px 35px rgba(34, 197, 94, 0.8), 0 0 30px rgba(255, 215, 0, 0.6);
            }

            60% {
                transform: translateY(-7px) scale(1.05);
                box-shadow: 0 10px 32px rgba(34, 197, 94, 0.7), 0 0 25px rgba(255, 215, 0, 0.5);
            }
        }

        @keyframes pulse-red {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 8px 25px rgba(239, 68, 68, 0.6);
            }

            50% {
                transform: scale(1.1);
                box-shadow: 0 10px 30px rgba(239, 68, 68, 0.8);
            }
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-15px);
            }

            60% {
                transform: translateY(-7px);
            }
        }

        .drawn-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            margin-bottom: 16px;
            max-height: 300px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
        }

        .drawn-grid .number-btn {
            font-size: 12px;
            height: 32px;
        }

        .matches-counter {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            font-weight: 600;
        }

        /* Results Display */
        .results-display {
            text-align: center;
        }

        .result-card {
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .result-card.win {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .result-card.lose {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .result-amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .result-amount.win {
            color: #4ade80;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }

        .result-amount.lose {
            color: #f87171;
        }

        .result-details {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            position: relative;
            z-index: 1;
        }

        .numbers-section {
            margin-bottom: 24px;
        }

        .numbers-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .numbers-display {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }

        .number-ball {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .number-ball.winning {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .number-ball.selected {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .number-ball.matched {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
            animation: pulse 1s infinite;
        }

        .result-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .result-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .result-btn.primary {
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 81, 47, 0.4);
        }

        .result-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 81, 47, 0.5);
        }

        .result-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Game History */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-1px);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .history-amount {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .history-amount.win {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .history-amount.lose {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .history-details {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .history-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 11px;
        }

        .history-numbers span {
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            font-weight: 500;
        }

        .history-numbers .selected {
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
        }

        .history-numbers .drawn {
            color: #f87171;
            background: rgba(248, 113, 113, 0.1);
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
        }

        /* Settings and Toggles Styles */
        .settings-section {
            background: white;
            margin-bottom: 12px;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 16px;
            color: #000;
        }


        .contact-btn,
        .terms-btn {
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .contact-btn:hover,
        .terms-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 81, 47, 0.5);
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #2196F3;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(20px);
            min-width: 160px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            z-index: 200;
            right: 0;
            top: 100%;
            margin-top: 8px;
            overflow: hidden;
        }

        .dropdown-content.show {
            display: block;
            animation: dropdownSlide 0.3s ease;
        }

        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dropdown-item:first-child {
            border-radius: 16px 16px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 16px 16px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(20px);
            color: white;
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* Game Logo Section */
        .game-logo-section {
            text-align: center;
            margin-bottom: 0px;
            padding: 10px 0;
        }

        /* Chapa Payment Styles */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .payment-method {
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .payment-method:hover {
            border-color: rgba(0, 180, 219, 0.5);
            background: rgba(0, 180, 219, 0.1);
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .payment-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        #chapa-payment-form {
            margin-top: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .payment-processing {
            text-align: center;
            padding: 20px;
            color: #FFD700;
        }

        .payment-processing .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 215, 0, 0.3);
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .game-logo {
            font-size: 23px;
            font-weight: 900;
            background: linear-gradient(135deg, #019eff 0%, #8E2DE2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0px;
            letter-spacing: 1px;
            text-shadow: 0 4px 8px rgba(0, 180, 219, 0.3);
        }

        .game-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Authentication Modal Styles */
        .auth-modal-content {
            max-width: 400px;
            width: 95%;
            padding: 32px 24px;
            background: linear-gradient(135deg, rgba(18, 18, 18, 0.98) 0%, rgba(30, 30, 30, 0.95) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .auth-logo-icon {
            font-size: 48px;
            margin-bottom: 8px;
            filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.3));
        }

        .auth-title {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 40%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            letter-spacing: 2px;
        }

        .auth-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 500;
            margin: 0;
        }

        .auth-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 4px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #00B4DB 0%, #8E2DE2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 180, 219, 0.4);
            transform: translateY(-1px);
        }

        .auth-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .auth-form {
            display: block;
        }

        .auth-form.hidden {
            display: none;
        }

        .form-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: 8px;
        }

        .form-subtitle {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            z-index: 2;
        }

        .auth-input {
            width: 100%;
            padding: 16px 16px 16px 50px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            outline: none;
        }

        .auth-input:focus {
            border-color: rgba(0, 180, 219, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(0, 180, 219, 0.2);
        }

        .auth-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-helper {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
            margin-left: 8px;
        }

        .bonus-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .bonus-icon {
            font-size: 24px;
            filter: drop-shadow(0 2px 4px rgba(34, 197, 94, 0.3));
        }

        .bonus-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .bonus-text strong {
            color: #4ade80;
            font-size: 14px;
            font-weight: 700;
        }

        .bonus-text span {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 81, 47, 0.4);
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 81, 47, 0.5);
        }

        .register-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        .register-btn:hover {
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.5);
        }

        .button-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .auth-button:hover .button-shine {
            left: 100%;
        }

        .auth-footer {
            text-align: center;
            margin-top: 16px;
        }

        .auth-footer p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            margin: 0;
        }

        /* Welcome Modal Styles */
        .welcome-modal-content {
            max-width: 450px;
            width: 95%;
            padding: 40px 32px;
            background: linear-gradient(135deg, rgba(18, 18, 18, 0.98) 0%, rgba(30, 30, 30, 0.95) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-animation {
            position: relative;
            margin-bottom: 32px;
        }

        .confetti-burst {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: burst 2s infinite;
        }

        @keyframes burst {

            0%,
            100% {
                transform: translateX(-50%) scale(0.8);
                opacity: 0.5;
            }

            50% {
                transform: translateX(-50%) scale(1.2);
                opacity: 1;
            }
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 16px;
            filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.4));
            animation: bounce 2s infinite;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 40%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 24px 0;
            letter-spacing: 1px;
        }

        .bonus-announcement {
            margin-bottom: 24px;
        }

        .bonus-badge {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
            border: 2px solid rgba(34, 197, 94, 0.4);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .bonus-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(34, 197, 94, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .bonus-amount {
            font-size: 32px;
            font-weight: 900;
            color: #4ade80;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
            position: relative;
            z-index: 1;
        }

        .bonus-label {
            font-size: 12px;
            font-weight: 700;
            color: #22c55e;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .welcome-message {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 32px;
            padding: 0 16px;
        }

        .welcome-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .welcome-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .welcome-close:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: scale(1.1);
        }

        .how-to-play-btn {
            flex: 1;
            padding: 16px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(142, 45, 226, 0.4);
        }

        .how-to-play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(142, 45, 226, 0.5);
        }

        .btn-gradient {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .how-to-play-btn:hover .btn-gradient {
            left: 100%;
        }

        /* How to Play Modal Styles */
        .how-to-play-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .step:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 700;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(255, 81, 47, 0.3);
        }

        .step-content h3 {
            color: white;
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 8px 0;
        }

        .step-content p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .header {
                padding: 6px 10px;
                min-height: 45px;
            }

            .balance-section {
                padding: 4px 8px;
                gap: 4px;
            }

            .balance-amount {
                font-size: 12px;
            }

            .header-btn {
                min-width: 70px;
                height: 38px;
                font-size: 12px;
                padding: 6px 8px;
                gap: 4px;
            }

            .btn-text {
                font-size: 10px;
            }

            .btn-icon {
                font-size: 14px;
            }

            .header-actions {
                gap: 6px;
            }

            .settings-content {
                width: 95%;
                margin: 10px;
            }

            .settings-user-info {
                padding: 15px;
            }

            .user-avatar-large {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .user-name-large {
                font-size: 16px;
            }

            .settings-item {
                padding: 12px 15px;
            }

            .settings-item-title {
                font-size: 14px;
            }

            .game-title h1 {
                font-size: 24px;
            }

            .number-grid {
                grid-template-columns: repeat(10, 1fr);
                gap: 2px;
                padding: 4px;
            }

            .number-btn {
                font-size: clamp(9px, 2.8vw, 12px);
                min-height: 28px;
                min-width: 28px;
            }

            .drawn-grid {
                grid-template-columns: repeat(10, 1fr);
            }

            .betting-section {
                padding: 10px;
            }

            .play-button-container {
                flex-direction: column;
            }

            .play-btn {
                width: 100%;
            }

            .modal-content {
                padding: 16px;
                margin: 10px;
            }

            .history-btn {
                width: 48px;
                height: 48px;
                bottom: 80px;
            }

            .quick-actions {
                gap: 4px;
                margin-bottom: 10px;
            }

            .quick-action-btn {
                padding: 8px 6px;
                font-size: 11px;
                min-height: 32px;
            }

            .action-btn {
                padding: 6px 4px;
                font-size: 15px;
                min-height: 24px;
            }
        }

        @media (max-width: 360px) {
            .number-grid {
                grid-template-columns: repeat(10, 1fr);
                gap: 1px;
                padding: 3px;
            }

            .number-btn {
                font-size: clamp(8px, 2.5vw, 10px);
                min-height: 24px;
                min-width: 24px;
            }

            .drawn-grid {
                grid-template-columns: repeat(10, 1fr);
            }

            .game-title h1 {
                font-size: 20px;
            }

            .quick-action-btn {
                padding: 6px 4px;
                font-size: 10px;
                min-height: 28px;
            }

            .action-btn {
                padding: 5px 3px;
                font-size: 15px;
                min-height: 22px;
            }
        }

        @media (min-width: 768px) {
            .number-grid {
                gap: 4px;
                padding: 8px;
            }

            .number-btn {
                font-size: clamp(12px, 2.2vw, 16px);
                min-height: 40px;
                min-width: 40px;
            }

            .number-grid-container {
                padding: 10px;
            }
        }

        @media (min-width: 1024px) {
            .number-grid {
                gap: 5px;
                padding: 10px;
            }

            .number-btn {
                font-size: clamp(14px, 1.8vw, 18px);
                min-height: 48px;
                min-width: 48px;
            }

            .number-grid-container {
                padding: 12px;
            }

            .action-btn {
                padding: 10px 8px;
                font-size: 15px;
                min-height: 32px;
            }
        }
    </style>
</head>

<body>
    <!-- Registration/Login Modal -->
    <div class="modal" id="auth-modal">
        <div class="modal-content auth-modal-content">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="auth-logo-icon">🎰</div>
                    <h1 class="auth-title">251KENO</h1>
                    <p class="auth-subtitle">Ethiopia's Premier Keno Game</p>
                </div>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab" id="login-tab" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab active" id="register-tab" onclick="switchAuthTab('register')">Register</button>
            </div>

            <!-- Login Form -->
            <div class="auth-form hidden" id="login-form">
                <h2 class="form-title">Welcome Back!</h2>
                <p class="form-subtitle">Enter your details to continue playing</p>

                <div class="input-group">
                    <div class="input-icon">👤</div>
                    <input type="text" id="login-name" placeholder="Your Name" class="auth-input" required>
                </div>

                <div class="input-group">
                    <div class="input-icon">📱</div>
                    <input type="tel" id="login-phone" placeholder="Ethiopian Phone Number (09xxxxxxxx)" class="auth-input" maxlength="10" required>
                    <div class="input-helper">Format: 09xxxxxxxx</div>
                </div>

                <button class="auth-button" id="login-btn" onclick="handleLogin()">
                    <span class="button-text">🎮 Start Playing</span>
                    <div class="button-shine"></div>
                </button>
            </div>

            <!-- Register Form -->
            <div class="auth-form" id="register-form">
                <h2 class="form-title">Join 251KENO!</h2>
                <p class="form-subtitle">Create your account and get 25 ETB bonus</p>

                <div class="input-group">
                    <div class="input-icon">👤</div>
                    <input type="text" id="register-name" placeholder="Your Full Name" class="auth-input" required>
                </div>

                <div class="input-group">
                    <div class="input-icon">📱</div>
                    <input type="tel" id="register-phone" placeholder="Ethiopian Phone Number (09xxxxxxxx)" class="auth-input" maxlength="10" required>
                    <div class="input-helper">Format: 09xxxxxxxx</div>
                </div>

                <div class="bonus-preview">
                    <div class="bonus-icon">💰</div>
                    <div class="bonus-text">
                        <strong>Welcome Bonus</strong>
                        <span>Get 25 ETB FREE when you register!</span>
                    </div>
                </div>

                <button class="auth-button register-btn" id="register-btn" onclick="handleRegister()">
                    <span class="button-text">🎉 Register & Get Bonus</span>
                    <div class="button-shine"></div>
                </button>
            </div>

            <div class="auth-footer">
                <p>By continuing, you agree to our Terms & Conditions</p>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div class="modal" id="welcome-modal">
        <div class="modal-content welcome-modal-content">
            <div class="welcome-animation">
                <div class="confetti-burst"></div>
                <div class="welcome-icon">🎉</div>
            </div>

            <div class="welcome-content">
                <h1 class="welcome-title">Welcome to 251Keno Game!!</h1>
                <div class="bonus-announcement">
                    <div class="bonus-badge">
                        <span class="bonus-amount">25 ETB</span>
                        <span class="bonus-label">BONUS CREDITED!</span>
                    </div>
                </div>
                <p class="welcome-message">Your account has been created successfully and your welcome bonus has been
                    added to your balance. Good luck and have fun playing!</p>
            </div>

            <div class="welcome-actions">
                <button class="modal-close welcome-close" onclick="closeWelcomeModal()">✕</button>
                <button class="how-to-play-btn" onclick="showHowToPlay()">
                    <span>How To Play?</span>
                    <div class="btn-gradient"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- How to Play Modal -->
    <div class="modal" id="how-to-play-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🎯 How to Play 251KENO</h2>
                <button class="modal-close" onclick="closeHowToPlayModal()">×</button>
            </div>
            <div class="how-to-play-content">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Select Numbers</h3>
                        <p>Choose up to 10 numbers from 1 to 80 on the grid</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Set Your Bet</h3>
                        <p>Choose your bet amount (minimum 5 ETB)</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Play Game</h3>
                        <p>Click "Play Game" to start the draw</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Win Prizes</h3>
                        <p>Match numbers to win! More matches = bigger wins</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Original Header (Hidden) -->
        <header class="header" style="display: none;">
            <div class="header-content">
                <div class="balance-section">
                    <div class="balance-icon">$</div>
                    <div class="balance-amount" id="balance-old">0.00 ETB</div>
                </div>
                <div class="header-actions">
                    <!-- User info when logged in -->
                    <div class="user-info" id="user-info-old" style="display: none;">
                        <div class="user-avatar" id="user-avatar-old">U</div>
                        <span id="user-name-old">User</span>
                        <button class="header-btn logout-btn" onclick="logout()">
                            🚪 Logout
                        </button>
                    </div>

                    <!-- Login button when not logged in -->
                    <button class="header-btn" onclick="showAuthModal()" id="login-btn-old">
                        <i class="fas fa-user"></i> Login
                    </button>

                    <!-- Admin Access Button -->
                    <button class="header-btn admin-btn" onclick="showAdminAccess()" style="margin-left: 10px; background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                        <i class="fas fa-shield-alt"></i> Admin
                    </button>
                </div>
            </div>
        </header>

        <!-- New Header -->
        <header class="header">
            <div class="header-content">
                <div class="balance-section">
                    <div class="balance-icon">💰</div>
                    <div class="balance-amount" id="balance">0.00 ETB</div>
                    <div class="music-indicator" id="music-indicator" style="display: none;">🎵</div>
                </div>
                <div class="header-actions">
                    <!-- Login button when not logged in -->
                    <button class="header-btn login-btn" onclick="showAuthModal()" id="header-login-btn" style="display: block;">
                        <span class="btn-icon">👤</span>
                        <span class="btn-text">Login</span>
                    </button>

                    <button class="header-btn deposit-btn" onclick="toggleDepositModal()" id="deposit-withdraw-btn" style="display: none;">
                        <span class="btn-icon">💳</span>
                        <span class="btn-text">Deposit</span>
                    </button>

                    <button class="header-btn menu-btn" onclick="openSettings()">
                        <span class="btn-icon">⚙️</span>
                        <span class="btn-text">Menu</span>
                    </button>
                </div>
            </div>
        </header>



        <!-- Main Content -->
        <main class="main-content">
            <!-- Game Logo and Title -->
            <div class="game-logo-section">
                <div class="game-logo">251KENO</div>
                <div class="game-subtitle">Select Your Lucky Numbers 1 - 10</div>
            </div>

            <!-- Round Timer and Info -->

            <!-- Tickets Section -->
            <div class="tickets-section" id="tickets-section" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 16px; margin-bottom: 16px; display: none;">
                <div class="tickets-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div class="tickets-title" style="color: white; font-size: 16px; font-weight: 600;">
                        Your Tickets (<span id="ticket-count">0</span>/10)
                    </div>
                    <button class="clear-tickets-btn" onclick="clearAllTickets()" style="padding: 6px 12px; background: rgba(255, 107, 107, 0.2); color: #ff6b6b; border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 8px; font-size: 12px; cursor: pointer;">
                        Clear All
                    </button>
                </div>
                <div class="tickets-list" id="tickets-list">
                    <!-- Tickets will be populated here -->
                </div>
            </div>

            <!-- Possible Win Display -->
            <div id="possible-win-container"
                style="display: none; text-align: center; margin-bottom: 16px; padding: 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 16px;">
                <div style="color: #22c55e; font-size: 18px; font-weight: 700;" id="possible-win-display">Possible Win:
                    0.00 ETB</div>
            </div>

            <!-- Number Grid -->
            <div class="number-grid-container">
                <div class="grid-header">
                    <div class="grid-title">Select Numbers</div>
                    <div class="selected-count" id="selected-count">0/10</div>
                </div>
                <div class="number-grid" id="number-grid">
                    <!-- Numbers will be generated by JavaScript -->
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="quick-action-btn auto-pick" onclick="autoPick()">
                    ✨ Auto Pick
                </button>
                <button class="quick-action-btn" onclick="clearTable()">
                    🗑️ Clear
                </button>
            </div>

            <!-- Betting Section -->
            <div class="betting-section">
                <div class="bet-control">
                    <div class="bet-label">
                        Bet Amount
                        <span class="balance-info">Balance: <span id="balance-display">0.00</span> ETB</span>
                    </div>
                    <div class="bet-amount-control">
                        <button class="bet-btn" onclick="changeBetAmount(-5)">−</button>
                        <span class="bet-amount-display" id="bet-amount-display">5.00 ETB</span>
                        <button class="bet-btn" onclick="changeBetAmount(5)">+</button>
                    </div>
                    <input type="range" class="bet-slider" id="bet-slider" min="5" max="100" step="5" value="5">
                </div>

                <div class="status-bar">
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">
                        <span id="numbers-selected">0</span> numbers selected
                    </div>
                </div>

                <div class="play-button-container">
                    <div style="display: flex; gap: 3px; flex: 1;">
                        <button class="action-btn" id="double-bet-btn" onclick="doubleBet()" style="flex: 1;">2×</button>
                        <div style="width: 1px; background: rgba(255, 255, 255, 0.15); margin: 2px 0;"></div>
                        <button class="action-btn" id="max-bet-btn" onclick="maxBet()" style="flex: 1;">Max</button>
                    </div>
                    <button class="play-btn" id="play-btn" onclick="playGame()">Play Game</button>
                </div>
                <div id="bet-warning" style="color: #f87171; font-size: 12px; margin-top: 8px; text-align: center;">
                </div>
            </div>

            <!-- Community Section with Tabs -->
            <div class="community-section">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" id="live-bets-tab" onclick="switchTab('live-bets')">
                        <div class="live-indicator"></div>
                        Live Bets
                    </button>
                    <button class="tab-btn" id="leaderboard-tab" onclick="switchTab('leaderboard')">
                        🏆 Leaderboard
                    </button>
                    <button class="tab-btn" id="results-tab" onclick="switchTab('results')">
                        📊 Results
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Live Bets Tab -->
                    <div class="tab-pane active" id="live-bets-pane">
                        <div class="live-bets-header">
                            <div class="live-count" id="live-count">0 players</div>
                        </div>
                        <div class="live-bets-feed" id="live-bets-feed">
                            <!-- Live bets will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Leaderboard Tab -->
                    <div class="tab-pane" id="leaderboard-pane">
                        <div class="leaderboard-container">
                            <div class="leaderboard-table" id="leaderboard-table">
                                <!-- Leaderboard will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Results Tab -->
                    <div class="tab-pane" id="results-pane">
                        <div class="results-container">
                            <div class="drawn-numbers-display" id="drawn-numbers-display">
                                <div class="section-title">Last Draw Results</div>
                                <div class="numbers-balls" id="results-drawn-balls">
                                    <!-- Drawn numbers will be populated -->
                                </div>
                            </div>
                            <div class="winners-list" id="winners-list">
                                <div class="section-title">Recent Winners</div>
                                <div class="winners-feed" id="winners-feed">
                                    <!-- Winners will be populated -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- History Button -->
        <button class="history-btn" onclick="showHistory()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        </button>

        <!-- Drawing Animation Modal -->
        <div class="modal" id="drawing-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Drawing Numbers</h2>
                    <button class="modal-close" id="drawing-modal-close" onclick="closeDrawingModal()" style="display: none;">×</button>
                </div>
                <div class="drawing-animation" id="drawing-animation">
                    <!-- Drawing animation content will be generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Game History Modal -->
        <div class="modal" id="history-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Game History</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="refreshGameHistory()" style="padding: 8px 12px; background: linear-gradient(135deg, #15aabf, #1098f7); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            🔄 Refresh
                        </button>
                        <button class="modal-close" onclick="closeHistoryModal()">×</button>
                    </div>
                </div>
                <div class="history-list" id="history-list">
                    <!-- History items will be generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Confetti Canvas -->
        <canvas id="confetti-canvas"></canvas>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>

        <!-- Admin Access Modal -->
        <div class="modal" id="admin-modal">
            <div class="modal-content" style="width: 90%; max-width: 500px;">
                <div class="modal-header">
                    <h2 class="modal-title">🔐 Admin Access</h2>
                    <button class="modal-close" onclick="closeAdminModal()">×</button>
                </div>
                <div class="modal-body">
                    <div id="admin-login-form">
                        <div style="margin-bottom: 20px;">
                            <label for="admin-password" style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">Admin Password:</label>
                            <input type="password" id="admin-password" placeholder="Enter admin password" 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255,255,255,0.15); color: white; font-size: 14px;">
                        </div>
                        <button onclick="adminLogin()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                            🔐 Login as Admin
                        </button>
                    </div>
                    
                    <div id="admin-panel" style="display: none;">
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #ff6b6b; margin-bottom: 15px;">Admin Panel</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <button onclick="openAdminPanel('admin.php')" style="padding: 12px; background: linear-gradient(135deg, #15aabf, #1098f7); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    📊 Basic Admin
                                </button>
                                <button onclick="openAdminPanel('admin-enhanced.php')" style="padding: 12px; background: linear-gradient(135deg, #40c057, #28a745); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    🚀 Enhanced Admin
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: rgba(255,255,255,0.8); margin-bottom: 10px;">Quick Actions:</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button onclick="openDatabaseMigration()" style="padding: 10px; background: linear-gradient(135deg, #fd7e14, #e8590c); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    🗄️ Migrate DB
                                </button>
                                <button onclick="testBackend()" style="padding: 10px; background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    🧪 Test Backend
                                </button>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <button onclick="testDatabaseConnection()" style="padding: 10px; background: linear-gradient(135deg, #20c997, #198754); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    🗃️ Test DB
                                </button>
                                <button onclick="checkBackendHealth()" style="padding: 10px; background: linear-gradient(135deg, #0dcaf0, #0aa2c0); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    🔍 Health Check
                                </button>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <button onclick="openDetailedDatabaseTest()" style="padding: 10px; background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    🔬 Detailed DB Test
                                </button>
                                <button onclick="openAdminPanel('admin-enhanced.php')" style="padding: 10px; background: linear-gradient(135deg, #fd7e14, #e8590c); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    ⚙️ Enhanced Admin
                                </button>
                            </div>
                        </div>
                        
                        <button onclick="adminLogout()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            🚪 Logout Admin
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Deposit/Withdraw Modal -->
        <div class="modal" id="deposit-modal" onclick="event.target === this && closeDepositModal()">
            <div class="modal-content" style="width: 90%; max-width: 400px;" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 class="modal-title">💰 Deposit / ⬇️ Withdraw</h2>
                    <button class="modal-close" onclick="closeDepositModal()" style="font-size: 18px; background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 8px; border: none; color: white; cursor: pointer;">
                        ←
                    </button>
                </div>
                <div class="modal-body">
                    <div class="tab-container" style="display: flex; gap: 8px; margin-bottom: 20px;">
                        <button class="tab-button active" id="deposit-tab" onclick="showDepositTab()" style="flex: 1; padding: 12px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; background: linear-gradient(135deg, #40c057, #28a745); color: white; transition: all 0.3s ease;">
                            💰 Deposit
                        </button>
                        <button class="tab-button" id="withdraw-tab" onclick="showWithdrawTab()" style="flex: 1; padding: 12px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; background: linear-gradient(135deg, #f03e3e, #c92a2a); color: white; opacity: 0.7; transition: all 0.3s ease;">
                            ⬇️ Withdraw
                        </button>
                    </div>

                    <div id="deposit-content" style="display: block;">
                        <!-- Payment Method Selection -->
                        <div class="payment-methods" id="payment-methods">
                            <div class="payment-method selected" data-method="telebirr"
                                onclick="selectPaymentMethod('telebirr')">
                                <span class="payment-icon">📱</span>
                                <div>Telebirr</div>
                            </div>
                            <div class="payment-method" data-method="cbebirr" onclick="selectPaymentMethod('cbebirr')">
                                <span class="payment-icon">🏦</span>
                                <div>CBE Birr</div>
                            </div>
                            <div class="payment-method" data-method="ebirr" onclick="selectPaymentMethod('ebirr')">
                                <span class="payment-icon">💳</span>
                                <div>eBirr</div>
                            </div>
                            <div class="payment-method" data-method="mpesa" onclick="selectPaymentMethod('mpesa')">
                                <span class="payment-icon">💰</span>
                                <div>M-Pesa</div>
                            </div>
                        </div>

                        <input type="number" placeholder="Enter Amount (min 5 ETB)" id="deposit-amount"
                               style="width: 100%; padding: 12px; margin-bottom: 15px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.15); color: white; font-size: 14px; backdrop-filter: blur(10px);"
                               min="5" value="5">

                        <button onclick="initializeChapa()" id="pay-now-btn"
                                style="width: 100%; padding: 14px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; background: linear-gradient(135deg, #15aabf, #1098f7); color: white; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px;">
                            💳 Pay Now
                        </button>

                        <!-- Chapa Payment Form Container -->
                        <div id="chapa-payment-form" style="display: none;"></div>

                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; text-align: center;">Minimum
                            deposit: 5 ETB • Secure payment powered by Chapa</p>
                    </div>

                    <div id="withdraw-content" style="display: none;">
                        <input type="text" placeholder="Phone or Account Number" id="withdraw-account" style="width: 100%; padding: 12px; margin-bottom: 15px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.15); color: white; font-size: 14px; backdrop-filter: blur(10px);">
                        <input type="number" placeholder="Enter Amount" id="withdraw-amount" style="width: 100%; padding: 12px; margin-bottom: 15px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.15); color: white; font-size: 14px; backdrop-filter: blur(10px);" min="20">
                        <button onclick="submitWithdraw()" style="width: 100%; padding: 14px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; background: linear-gradient(135deg, #f03e3e, #c92a2a); color: white; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px;">
                            Withdraw Now
                        </button>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; text-align: center;">Balance:
                            <span id="modal-balance">0.00</span> ETB | Min: 20 ETB, Max: 500 ETB
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content" style="width: 90%; max-width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close" onclick="closeSettings()" style="font-size: 18px; background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 8px; border: none; color: white; cursor: pointer;">
                    ×
                </button>
            </div>
            div class="modal-body"div
            style
            .settings-section {
            margin-bottom: 12px;
            padding: 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: background 0.3s ease;
            }
            .settings-section:hover {
            background: linear-gradient(135deg, #e2ebf5, #b0beda);
            }
            .settings-section h3 {
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            }
            .settings-section p {
            margin: 5px 0;
            font-size: 14px;
            color: #555;
            }
            /style
            <div class="settings-section">
                <h3>Lifetime Play and Win History</h3>
                <p>(requires PHP backend)</p>
            </div>
            <div class="settings-section">
                <h3>Referral Section</h3>
                <p>Show user's unique referral code (copiable).</p>
                <p>"Invite & Earn" bonus logic (optional backend).</p>
            </div>
            
            <div class="settings-section">
                <h3>Backend Integration</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <button onclick="checkBackendHealth()" style="padding: 8px; background: linear-gradient(135deg, #15aabf, #1098f7); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        🔍 Check Backend
                    </button>
                    <button onclick="loadGameContent()" style="padding: 8px; background: linear-gradient(135deg, #40c057, #28a745); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        📄 Load Content
                    </button>
                </div>
            </div>
            <div class="settings-section">
                <h3>T\u0026Cs Page</h3>
                <p class="terms-text">All terms and conditions here</p>
            </div>
            <div class="settings-section">
                <h3>Contact & Support</h3>
                <p>Call: 📞 0985535022</p>
                <p>Telegram: t.me/Miko_Cr7</p>
            </div>
            <div class="settings-section">
                <h3>Fairness Check</h3>
                <p>Add a section for users to validate that games are fair (display hash or dummy seed if needed).</p>
            </div>
            
            <!-- Logout Section -->
            <div class="settings-section" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white;">
                <h3 style="color: white;">🚪 Account</h3>
                <p style="color: rgba(255,255,255,0.9);">Manage your account and logout</p>
                <button onclick="logout()" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin-top: 10px; transition: all 0.3s ease;">
                    🚪 Logout
                </button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Game State - Enhanced for Round-Based System
        let gameState = {
            selectedNumbers: [],
            betAmount: 5.00,
            riskLevel: 'medium',
            balance: 0.00,
            isPlaying: false,
            drawnNumbers: [],
            lastWin: 0,
            gameHistory: [],
            currentDrawIndex: 0,
            showResults: false,
            isFirstTime: !localStorage.getItem('kenoPlayed'),
            tutorialStep: 0,
            inTutorial: false,
            soundsEnabled: true,
            musicEnabled: false,
            // Round-based system properties
            currentRound: 1,
            roundTimeLeft: 60,
            roundActive: false,
            tickets: [],
            roundResults: null,
            roundTimer: null,
            roundPhase: 'betting' // 'betting', 'drawing', 'results'
        };

        // Ticket system
        let ticketSystem = {
            nextTicketId: 1,
            currentRoundTickets: [],
            maxTicketsPerRound: 10
        };

        // Tutorial Functions
        function startTutorial() {
            if (gameState.inTutorial) return;
            gameState.inTutorial = true;
            gameState.tutorialStep = 0;
            showTutorialStep();
        }

        function showTutorialStep() {
            if (!gameState.inTutorial) return;
            const steps = [
                "Welcome to the Keno game! Let's get started.",
                "Select up to 10 numbers on the grid to place your bet.",
                "Adjust your bet amount with the slider or buttons.",
                "Press 'Play Game' to start the draw and see if you win!",
                "Match numbers are shown in green and gold!",
                "All set? You can restart the tutorial anytime from settings."
            ];

            if (gameState.tutorialStep < steps.length) {
                showToast(steps[gameState.tutorialStep]);
                gameState.tutorialStep++;
                setTimeout(showTutorialStep, 5000);
            } else {
                gameState.inTutorial = false;
            }
        }

        // Background Music Functions
        function toggleBackgroundMusic() {
            if (!audioContext) {
                initAudio();
            }

            if (!backgroundMusic) {
                backgroundMusic = audioContext.createBufferSource();
                musicGainNode = audioContext.createGain();
                backgroundMusic.connect(musicGainNode);
                musicGainNode.connect(audioContext.destination);
                musicGainNode.gain.value = 0.05; // Background music volume

                // Load music track
                fetch('background-music.mp3') // Replace with your music file URL
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                    .then(audioBuffer => {
                        backgroundMusic.buffer = audioBuffer;
                        backgroundMusic.loop = true;
                        backgroundMusic.start();
                        gameState.musicEnabled = true;
                        showToast('🎵 Background music playing!');
                    })
                    .catch(error => {
                        console.error('Error loading music:', error);
                    });
            } else if (gameState.musicEnabled) {
                musicGainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1);

                setTimeout(() => {
                    backgroundMusic.stop();
                    backgroundMusic = null;
                    gameState.musicEnabled = false;
                    showToast('🔇 Background music stopped.');
                }, 1000);
            }
        }

        // Audio Context for sound effects and music
        let audioContext = null;
        let backgroundMusic = null;
        let musicGainNode = null;

        // Live Bets System
        let liveBetsState = {
            bets: [],
            maxBets: 20,
            simulationActive: false,
            playerCount: 0
        };

        // Ethiopian player names and avatars
        const ethiopianNames = [
            'mi*******s', 'Yo****72', 'Jo***', 'Ki****_99', 'Sa*****el', 'Ab****h', 'Me***t', 'Ti****u',
            'Ha****e', 'Ge****w', 'Se****m', 'Be****n', 'Da****t', 'Ye****s', 'Ne****h', 'Ke****u',
            'Li****t', 'Bi****n', 'Sh****m', 'Wa****d', 'Te****y', 'Em****t', 'Fi****w', 'As****f',
            'Ma****m', 'Ze****u', 'Ro****l', 'Si****n', 'Hu****t', 'Ba****h', 'Le****m', 'Ta****u'
        ];

        const avatars = ['🧑‍💼', '👩‍🔬', '👨‍🌾', '🧑‍🔧', '👨‍💻', '👩‍🏫'];

        // Live Bets Functions
        function generateRandomBetAmount() {
            // 80% of bets under 50 ETB for realism
            if (Math.random() < 0.8) {
                return Math.floor(Math.random() * 45) + 5; // 5-49 ETB
            } else {
                return Math.floor(Math.random() * 351) + 50; // 50-400 ETB
            }
        }

        function getRandomPlayerName() {
            return ethiopianNames[Math.floor(Math.random() * ethiopianNames.length)];
        }

        function getRandomAvatar() {
            return avatars[Math.floor(Math.random() * avatars.length)];
        }

        function addLiveBet(playerName, avatar, amount) {
            const betItem = {
                id: Date.now() + Math.random(),
                player: playerName,
                avatar: avatar,
                amount: amount,
                timestamp: new Date()
            };

            liveBetsState.bets.unshift(betItem);
            
            // Keep only latest 20 bets
            if (liveBetsState.bets.length > liveBetsState.maxBets) {
                liveBetsState.bets.pop();
            }

            updateLiveBetsFeed();
        }

        function updateLiveBetsFeed() {
            const feed = document.getElementById('live-bets-feed');
            const liveCount = document.getElementById('live-count');
            
            // Update player count
            liveBetsState.playerCount = Math.min(liveBetsState.bets.length, liveBetsState.maxBets);
            liveCount.textContent = `${liveBetsState.playerCount} players`;

            // Clear and rebuild feed
            feed.innerHTML = '';
            
            liveBetsState.bets.forEach((bet, index) => {
                const betElement = document.createElement('div');
                betElement.className = `live-bet-item ${index === 0 ? 'new' : ''}`;
                betElement.innerHTML = `
                    <div class="bet-avatar">${bet.avatar}</div>
                    <div class="bet-player">${bet.player}</div>
                    <div class="bet-amount">${bet.amount} ETB</div>
                `;
                feed.appendChild(betElement);
                
                // Remove 'new' class after animation
                if (index === 0) {
                    setTimeout(() => {
                        betElement.classList.remove('new');
                    }, 500);
                }
            });

            // Auto-scroll to top for new bets
            feed.scrollTop = 0;
        }

        function simulateLiveBet() {
            if (!liveBetsState.simulationActive) return;
            
            const playerName = getRandomPlayerName();
            const avatar = getRandomAvatar();
            const amount = generateRandomBetAmount();
            
            addLiveBet(playerName, avatar, amount);
            
            // Schedule next bet (2-5 seconds)
            const nextBetDelay = Math.floor(Math.random() * 3000) + 2000;
            setTimeout(simulateLiveBet, nextBetDelay);
        }

        function startLiveBetsSimulation() {
            if (liveBetsState.simulationActive) return;
            
            liveBetsState.simulationActive = true;
            
            // Add initial bets to populate the feed
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const playerName = getRandomPlayerName();
                    const avatar = getRandomAvatar();
                    const amount = generateRandomBetAmount();
                    addLiveBet(playerName, avatar, amount);
                }, i * 300);
            }
            
            // Start continuous simulation after initial bets
            setTimeout(() => {
                simulateLiveBet();
            }, 3000);
        }

        function stopLiveBetsSimulation() {
            liveBetsState.simulationActive = false;
        }

        // Initialize the game
        function initGame() {
            generateNumberGrid();
            updateDisplay();
            updatePossibleWinDisplay();
            setupEventListeners();
            initAudio();
            startLiveBetsSimulation();

            // Start balance sync for logged in users
            startBalanceSync();
        }

        // Initialize audio context
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Generate number grid (1-80)
        function generateNumberGrid() {
            const grid = document.getElementById('number-grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 80; i++) {
                const button = document.createElement('button');
                button.className = 'number-btn default';
                button.textContent = i;
                button.onclick = () => toggleNumber(i);
                button.id = `number-${i}`;
                grid.appendChild(button);
            }
        }

        // Toggle number selection
        function toggleNumber(number) {
            if (gameState.isPlaying) return;
            
            const button = document.getElementById(`number-${number}`);
            const index = gameState.selectedNumbers.indexOf(number);
            
            if (index > -1) {
                gameState.selectedNumbers.splice(index, 1);
                button.className = 'number-btn default';
            } else if (gameState.selectedNumbers.length < 10) {
                gameState.selectedNumbers.push(number);
                button.className = 'number-btn selected';
                playSound(800, 100);
                vibrate(30);
            }
            
            updateDisplay();
        }

        // Update possible win display based on selected numbers and bet amount
        function updatePossibleWinDisplay() {
            const container = document.getElementById('possible-win-container');
            const display = document.getElementById('possible-win-display');
            
            if (gameState.selectedNumbers.length > 0) {
                const matches = gameState.selectedNumbers.length;
                const possibleWin = calculateWinAmount(matches, matches); // Using matches for both to predict max win
                display.textContent = `Possible Win: ${possibleWin.toFixed(2)} ETB`;
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        // Auto pick numbers
        function autoPick() {
            if (gameState.isPlaying) return;
            
            clearTable();
            const numbers = Array.from({length: 80}, (_, i) => i + 1);
            const shuffled = numbers.sort(() => Math.random() - 0.5);
            const count = Math.floor(Math.random() * 10) + 1;
            
            for (let i = 0; i < count; i++) {
                gameState.selectedNumbers.push(shuffled[i]);
                document.getElementById(`number-${shuffled[i]}`).className = 'number-btn selected';
            }
            
            updateDisplay();
            playSound(600, 150);
            vibrate(50);
        }

        // Clear selected numbers
        function clearTable() {
            if (gameState.isPlaying) return;
            
            gameState.selectedNumbers.forEach(num => {
                document.getElementById(`number-${num}`).className = 'number-btn default';
            });
            
            gameState.selectedNumbers = [];
            updateDisplay();
            updatePossibleWinDisplay();
            playSound(400, 100);
            vibrate(50);
        }

        // Change bet amount
        function changeBetAmount(delta) {
            const newAmount = Math.max(5, Math.min(gameState.balance, gameState.betAmount + delta));
            gameState.betAmount = newAmount;
            document.getElementById('bet-slider').value = newAmount;
            updateDisplay();
            updatePossibleWinDisplay();
            vibrate(30);
        }

        // Double bet function
        function doubleBet() {
            const doubleAmount = gameState.betAmount * 2;
            if (doubleAmount >= 5 && doubleAmount <= gameState.balance) {
                gameState.betAmount = doubleAmount;
                document.getElementById('bet-slider').value = doubleAmount;
                updateDisplay();
                updatePossibleWinDisplay();
                vibrate(30);
            } else {
                showToast('Max Bet Reached');
            }
        }

        // Max bet function
        function maxBet() {
            gameState.betAmount = gameState.balance;
            document.getElementById('bet-slider').value = gameState.balance;
            document.getElementById('bet-slider').max = gameState.balance;
            updateDisplay();
            updatePossibleWinDisplay();
            vibrate(30);
        }

        // Play game
        function playGame() {
            if (gameState.selectedNumbers.length === 0) {
                showToast('Please select at least 1 number to play.');
                return;
            }
            
            if (gameState.betAmount > gameState.balance) {
                showToast('Insufficient balance. Please lower your bet amount.');
                return;
            }
            
            const playerId = localStorage.getItem('playerId');
            if (!playerId) {
                showToast('❌ Please login to play');
                return;
            }
            
            gameState.isPlaying = true;
            gameState.balance -= gameState.betAmount;

            // Save balance to localStorage immediately
            localStorage.setItem('playerBalance', gameState.balance.toString());

            gameState.drawnNumbers = [];
            gameState.currentDrawIndex = 0;
            gameState.showResults = false;
            
            updateDisplay();
            showDrawingModal();
            playSound(500, 200);
            vibrate(100);
            
            // Generate drawn numbers
            const numbers = Array.from({length: 80}, (_, i) => i + 1);
            const shuffled = numbers.sort(() => Math.random() - 0.5);
            gameState.drawnNumbers = shuffled.slice(0, 20);
            
            // Start drawing animation
            startDrawingAnimation();
        }

        // Start drawing animation with countdown
        function startDrawingAnimation() {
            const animationDiv = document.getElementById('drawing-animation');
            let countdown = 3;
            
            function showCountdown() {
                if (countdown > 0) {
                    animationDiv.innerHTML = `
                        <div class="current-draw">
                            <div class="draw-counter">Drawing starts in...</div>
                            <div class="drawn-ball" style="font-size: 48px; animation: pulse 1s infinite;">${countdown}</div>
                        </div>
                    `;
                    playSound(600, 200);
                    vibrate(50);
                    countdown--;
                    setTimeout(showCountdown, 1000);
                } else {
                    drawNextNumber();
                }
            }
            
            function drawNextNumber() {
                if (gameState.currentDrawIndex < 20) {
                    updateDrawingAnimation();
                    playSound(600, 200);
                    vibrate(50);
                    gameState.currentDrawIndex++;
                    setTimeout(drawNextNumber, 1000);
                } else {
                    setTimeout(showResults, 1500);
                }
            }
            
            showCountdown();
        }

        // Update drawing animation
        function updateDrawingAnimation() {
            const animationDiv = document.getElementById('drawing-animation');
            const currentNumber = gameState.drawnNumbers[gameState.currentDrawIndex];
            const matches = gameState.selectedNumbers.filter(n => 
                gameState.drawnNumbers.slice(0, gameState.currentDrawIndex + 1).includes(n)
            ).length;
            
            // Update number grid in animation
            let gridHTML = '<div class="drawn-grid">';
            for (let i = 1; i <= 80; i++) {
                const isDrawn = gameState.drawnNumbers.slice(0, gameState.currentDrawIndex + 1).includes(i);
                const isSelected = gameState.selectedNumbers.includes(i);
                const isMatched = isSelected && isDrawn;
                
                let className = 'number-btn ';
                if (isMatched) className += 'matched';
                else if (isDrawn) className += 'drawn';
                else if (isSelected) className += 'selected';
                else className += 'default';
                
                gridHTML += `<button class="${className}" disabled>${i}</button>`;
            }
            gridHTML += '</div>';
            
            animationDiv.innerHTML = `
                <div class="current-draw">
                    <div class="draw-counter">Drawing ${gameState.currentDrawIndex + 1} of 20</div>
                    <div class="drawn-ball">${currentNumber}</div>
                </div>
                ${gridHTML}
                <div class="matches-counter">Matches: ${matches} / ${gameState.selectedNumbers.length}</div>
            `;
        }

        // Show results
        function showResults() {
            gameState.showResults = true;
            const matches = gameState.selectedNumbers.filter(n => gameState.drawnNumbers.includes(n)).length;
            const winAmount = calculateWinAmount(matches, gameState.selectedNumbers.length);
            
            gameState.lastWin = winAmount;
            gameState.balance += winAmount;

            // Save balance to localStorage immediately
            localStorage.setItem('playerBalance', gameState.balance.toString());
            
            // Show close button only in results phase
            document.getElementById('drawing-modal-close').style.display = 'flex';
            
            const animationDiv = document.getElementById('drawing-animation');
            const isWin = winAmount > 0;
            
            // Generate winning numbers display
            let winningNumbersHTML = '';
            gameState.drawnNumbers.forEach(num => {
                winningNumbersHTML += `<div class="number-ball winning">${num}</div>`;
            });
            
            // Generate selected numbers display
            let selectedNumbersHTML = '';
            gameState.selectedNumbers.forEach(num => {
                const isMatch = gameState.drawnNumbers.includes(num);
                selectedNumbersHTML += `<div class="number-ball ${isMatch ? 'matched' : 'selected'}">${num}</div>`;
            });
            
            animationDiv.innerHTML = `
                <div class="results-display">
                    <div class="result-card ${isWin ? 'win' : 'lose'}">
                        <div class="result-amount ${isWin ? 'win' : 'lose'}">
                            ${isWin ? winAmount.toFixed(2) + ' ETB' : 'No Win'}
                        </div>
                        <div class="result-details">
                            ${matches} matches out of ${gameState.selectedNumbers.length} numbers
                        </div>
                    </div>
                    
                    <div class="numbers-section">
                        <div class="numbers-title">Winning Numbers</div>
                        <div class="numbers-display">${winningNumbersHTML}</div>
                    </div>
                    
                    <div class="numbers-section">
                        <div class="numbers-title">Your Numbers</div>
                        <div class="numbers-display">${selectedNumbersHTML}</div>
                    </div>
                    
                    <div class="result-actions">
                        <button class="result-btn primary" onclick="playAgain()">Play Again</button>
                        <button class="result-btn secondary" onclick="closeDrawingModal()">Close</button>
                    </div>
                </div>
            `;
            
            // Add to history
            addToHistory(matches, winAmount);
            
            // Show confetti for wins
            if (isWin) {
                showConfetti();
                playWinSound();
                vibrate([100, 50, 100]);
            } else {
                playLoseSound();
                vibrate(200);
            }
            
            updateDisplay();
            showToast(isWin ? '🎉 Congratulations! You won!' : '😔 Better luck next time!');
            
            // Save game data to backend
            saveGameData(matches, winAmount);
        }
        
        // Save game data to backend
        function saveGameData(matches, winAmount) {
            const playerId = localStorage.getItem('playerId');
            if (!playerId) return;

            const gameData = {
                action: 'save_history',
                player_id: playerId,
                selected_numbers: gameState.selectedNumbers,
                drawn_numbers: gameState.drawnNumbers,
                bet_amount: gameState.betAmount,
                win_amount: winAmount,
                match_count: matches
            };

            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(gameData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Game data saved successfully');
                    // Sync balance to database after saving game
                    syncBalanceToDatabase();
                } else {
                    console.error('Error saving game data:', data.message);
                }
            })
            .catch(error => {
                console.error('Error saving game data:', error);
            });
        }

        // Sync current balance to database with conflict detection
        function syncBalanceToDatabase() {
            const playerId = localStorage.getItem('playerId');
            if (!playerId) return;

            const lastKnownDbBalance = localStorage.getItem('lastKnownDbBalance') || '0';

            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'set_balance',
                    player_id: playerId,
                    balance: gameState.balance,
                    last_known_balance: parseFloat(lastKnownDbBalance)
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update localStorage with synced balance
                    localStorage.setItem('playerBalance', gameState.balance.toString());
                    localStorage.setItem('lastKnownDbBalance', gameState.balance.toString());
                    console.log('Balance synced to database:', gameState.balance, 'ETB');
                } else {
                    // Handle balance conflicts
                    if (data.admin_override || data.balance_conflict) {
                        console.warn('Balance conflict detected:', data.message);

                        // Admin has modified balance, use database balance
                        const dbBalance = data.current_balance || data.database_balance;
                        if (dbBalance !== undefined) {
                            gameState.balance = parseFloat(dbBalance);
                            localStorage.setItem('playerBalance', dbBalance.toString());
                            localStorage.setItem('lastKnownDbBalance', dbBalance.toString());
                            updateDisplay();

                            // Show notification to user
                            showBalanceConflictNotification(data);
                        }
                    } else {
                        console.error('Error syncing balance:', data.message);
                    }
                }
            })
            .catch(error => {
                console.error('Error syncing balance:', error);
            });
        }

        // Show notification when balance conflict is detected
        function showBalanceConflictNotification(conflictData) {
            let message = '';

            if (conflictData.admin_override) {
                message = `Your balance was updated by an administrator. New balance: ${conflictData.current_balance} ETB`;
            } else if (conflictData.balance_conflict) {
                message = `Balance updated from server. New balance: ${conflictData.database_balance} ETB`;
            }

            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff9800;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 300px;
                font-weight: 500;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>${message}</div>
                </div>
            `;

            document.body.appendChild(notification);

            // Remove notification after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Auto-sync balance periodically (every 30 seconds)
        function startBalanceSync() {
            setInterval(() => {
                const playerId = localStorage.getItem('playerId');
                if (playerId && localStorage.getItem('isLoggedIn') === 'true') {
                    syncBalanceToDatabase();
                }
            }, 30000); // 30 seconds
        }

        // Modern Keno Payout System - ETB Currency
        function kenoPayoutEngine(picked, caught) {
            // Official Keno Payout Table - Based on your specifications
            // Structure: payoutTable[picked_numbers][matches] = multiplier
            const payoutTable = {
                1: [null, 3], // 1 pick: 0 matches = lose, 1 match = x3
                2: [null, null, 10], // 2 picks: 0-1 matches = lose, 2 matches = x10
                3: [null, null, 2, 20], // 3 picks: 0-1 matches = lose, 2 matches = x2, 3 matches = x20
                4: [null, null, null, 5, 50], // 4 picks: 0-2 matches = lose, 3 matches = x5, 4 matches = x50
                5: [null, null, null, 2, 15, 100], // 5 picks: 0-2 matches = lose, 3 matches = x2, 4 matches = x15, 5 matches = x100
                6: [null, null, null, null, 5, 30, 200], // 6 picks: 0-3 matches = lose, 4 matches = x5, 5 matches = x30, 6 matches = x200
                7: [null, null, null, null, null, 10, 50, 500], // 7 picks: 0-4 matches = lose, 5 matches = x10, 6 matches = x50, 7 matches = x500
                8: [null, null, null, null, null, null, 20, 100, 1000], // 8 picks: 0-5 matches = lose, 6 matches = x20, 7 matches = x100, 8 matches = x1000
                9: [null, null, null, null, null, null, null, 50, 500, 2000], // 9 picks: 0-6 matches = lose, 7 matches = x50, 8 matches = x500, 9 matches = x2000
                10: [null, null, null, null, null, null, null, null, 100, 1000, 5000] // 10 picks: 0-7 matches = lose, 8 matches = x100, 9 matches = x1000, 10 matches = x5000
            };

            // Input validation
            if (caught > picked || picked < 1 || picked > 10 || caught < 0) {
                return 0; // Invalid input returns 0 multiplier (lose bet)
            }

            // Check if payout table exists for this number of picks
            if (!payoutTable[picked]) {
                return 0; // No payout table = lose bet
            }

            // Check if multiplier exists for this number of matches
            if (caught >= payoutTable[picked].length || payoutTable[picked][caught] === null || payoutTable[picked][caught] === undefined) {
                return 0; // No multiplier or null = lose bet
            }

            // Return the multiplier for this combination
            return payoutTable[picked][caught];
        }

        // Calculate win amount using the professional Keno Payout Engine
        function calculateWinAmount(matches, selectedCount) {
            const multiplier = kenoPayoutEngine(selectedCount, matches);
            return gameState.betAmount * multiplier;
        }

        // Add to game history
        function addToHistory(matches, winAmount) {
            const historyEntry = {
                id: Date.now(),
                timestamp: new Date().toLocaleString(),
                selectedNumbers: [...gameState.selectedNumbers],
                drawnNumbers: [...gameState.drawnNumbers],
                matches: matches,
                betAmount: gameState.betAmount,
                winAmount: winAmount,
                riskLevel: gameState.riskLevel,
                savedToBackend: false // Mark as not yet saved to backend
            };
            
            // Add to local history (no limit - lifetime history)
            gameState.gameHistory.unshift(historyEntry);
            
            // Also save to backend (this is already handled by saveGameData function)
            console.log('✅ Game history updated locally and saved to backend');
        }

        // Play again
        function playAgain() {
            gameState.isPlaying = false;
            gameState.selectedNumbers = [];
            gameState.drawnNumbers = [];
            gameState.showResults = false;
            
            // Reset all number buttons
            for (let i = 1; i <= 80; i++) {
                document.getElementById(`number-${i}`).className = 'number-btn default';
            }
            
            // Hide close button when starting new game
            document.getElementById('drawing-modal-close').style.display = 'none';
            closeDrawingModal();
            updateDisplay();
        }

        // Update display
        function updateDisplay() {
            document.getElementById('balance').textContent = gameState.balance.toFixed(2) + ' ETB';
            document.getElementById('balance-display').textContent = gameState.balance.toFixed(2);
            document.getElementById('selected-count').textContent = gameState.selectedNumbers.length + '/10';
            document.getElementById('numbers-selected').textContent = gameState.selectedNumbers.length;
            document.getElementById('bet-amount-display').textContent = gameState.betAmount.toFixed(2) + ' ETB';

            // Update header authentication state
            updateHeaderAuthState();

            // Update bet validation warning
            const warningDiv = document.getElementById('bet-warning');
            let warningMessage = '';

            if (gameState.betAmount < 5) {
                warningMessage = 'Minimum bet is 5 ETB';
            } else if (gameState.betAmount > gameState.balance) {
                warningMessage = 'Insufficient balance';
            }

            warningDiv.textContent = warningMessage;

            // Update play button
            const playBtn = document.getElementById('play-btn');
            const canPlay = gameState.selectedNumbers.length > 0 &&
                          gameState.betAmount >= 5 &&
                          gameState.betAmount <= gameState.balance &&
                          !gameState.isPlaying;

            playBtn.disabled = !canPlay;
            playBtn.textContent = gameState.isPlaying ? 'Drawing...' : 'Play Game';
            playBtn.className = canPlay ? 'play-btn ready' : 'play-btn';
        }

        // Update header authentication state
        function updateHeaderAuthState() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const playerName = localStorage.getItem('playerName') || 'User';

            const loginBtn = document.getElementById('header-login-btn');
            const depositBtn = document.getElementById('deposit-withdraw-btn');

            if (isLoggedIn) {
                // Hide login button, show deposit button
                if (loginBtn) loginBtn.style.display = 'none';
                if (depositBtn) depositBtn.style.display = 'block';
            } else {
                // Show login button, hide deposit button
                if (loginBtn) loginBtn.style.display = 'block';
                if (depositBtn) depositBtn.style.display = 'none';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('bet-slider').addEventListener('input', function(e) {
                let value = parseFloat(e.target.value);
                // Ensure bet is within valid range and in 5 ETB increments
                value = Math.max(5, Math.min(gameState.balance, value));
                value = Math.round(value / 5) * 5; // Snap to 5 ETB increments
                gameState.betAmount = value;
                e.target.value = value;
                updateDisplay();
            });

            document.getElementById('bet-amount-display').addEventListener('blur', function(e) {
                let value = parseFloat(e.target.textContent);
                if (isNaN(value) || value < 5) value = 5;
                else if (value > gameState.balance) value = gameState.balance;
                gameState.betAmount = value;
                document.getElementById('bet-slider').value = value;
                updateDisplay();
                updatePossibleWinDisplay();
            });
            
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.matches('.deposit-btn') && !e.target.closest('.dropdown-content')) {
                    document.getElementById('deposit-dropdown').classList.remove('show');
                }
            });
            
            // Prevent modal from closing when clicking outside during drawing/results
            document.getElementById('drawing-modal').addEventListener('click', function(e) {
                if (e.target === this && (gameState.isPlaying && !gameState.showResults)) {
                    e.stopPropagation();
                    return false;
                }
            });
            
            // Prevent ESC key from closing modal during drawing
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && gameState.isPlaying && !gameState.showResults) {
                    e.preventDefault();
                    return false;
                }
            });
        }

        // Modal functions
        function showDrawingModal() {
            document.getElementById('drawing-modal').classList.add('active');
            // Hide close button during drawing phase
            document.getElementById('drawing-modal-close').style.display = 'none';
        }

        function closeDrawingModal() {
            // Only allow closing if results are shown or game is not playing
            if (!gameState.showResults && gameState.isPlaying) {
                return; // Prevent closing during drawing phase
            }
            
            document.getElementById('drawing-modal').classList.remove('active');
            gameState.isPlaying = false;
            updateDisplay();
        }

        function showHistory() {
            // Load fresh history from backend before showing
            const playerId = localStorage.getItem('playerId');
            if (playerId) {
                // Show loading state
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.5); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🔄</div>
                        <div style="margin-bottom: 8px;">Loading game history...</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.3);">Please wait while we fetch your data</div>
                    </div>`;
                
                document.getElementById('history-modal').classList.add('active');
                
                // Load data from backend
                loadGameHistoryFromBackend(playerId);
                setTimeout(() => {
                    updateHistoryDisplay();
                }, 500);
            } else {
                // Fallback to local history if no player ID
                updateHistoryDisplay();
                document.getElementById('history-modal').classList.add('active');
            }
        }

        function closeHistoryModal() {
            document.getElementById('history-modal').classList.remove('active');
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('history-list');
            
            if (gameState.gameHistory.length === 0) {
                historyList.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.5); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🎮</div>
                        <div style="margin-bottom: 8px;">No games played yet</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.3);">Start playing to see your history here!</div>
                    </div>`;
                return;
            }
            
            let historyHTML = '';
            gameState.gameHistory.forEach((game, index) => {
                const isWin = game.winAmount > 0;
                const isRecent = index === 0; // Most recent game
                historyHTML += `
                    <div class="history-item" style="${isRecent ? 'border-left: 4px solid #40c057;' : ''}">
                        <div class="history-header">
                            <span class="history-time">${game.timestamp}</span>
                            <span class="history-amount ${isWin ? 'win' : 'lose'}">
                                ${isWin ? '+' : '-'}${isWin ? game.winAmount.toFixed(2) : game.betAmount.toFixed(2)} ETB
                            </span>
                        </div>
                        <div class="history-details">
                            ${game.matches} matches • ${game.riskLevel} risk
                            ${isRecent ? '<span style="color: #40c057; font-weight: bold;"> • Latest</span>' : ''}
                        </div>
                        <div class="history-numbers">
                            <span class="selected">Your: ${game.selectedNumbers.slice(0, 5).join(', ')}${game.selectedNumbers.length > 5 ? '...' : ''}</span>
                            <span class="drawn">Drawn: ${game.drawnNumbers.slice(0, 5).join(', ')}...</span>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = historyHTML;
        }



        // Deposit/Withdraw Modal Functions
        function toggleDepositModal() {
            const modal = document.getElementById('deposit-modal');
            modal.classList.add('active');
            // Update balance in modal
            const modalBalance = document.getElementById('modal-balance');
            if (modalBalance) {
                modalBalance.textContent = gameState.balance.toFixed(2);
            }
        }

        function closeDepositModal() {
            const modal = document.getElementById('deposit-modal');
            modal.classList.remove('active');
            // Clear form fields
            document.getElementById('deposit-amount').value = '';
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-account').value = '';
        }

        function showDepositTab() {
            document.getElementById('deposit-content').style.display = 'block';
            document.getElementById('withdraw-content').style.display = 'none';
            
            const depositTab = document.getElementById('deposit-tab');
            const withdrawTab = document.getElementById('withdraw-tab');
            
            depositTab.style.opacity = '1';
            depositTab.style.transform = 'translateY(-2px)';
            depositTab.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
            
            withdrawTab.style.opacity = '0.7';
            withdrawTab.style.transform = 'translateY(0)';
            withdrawTab.style.boxShadow = 'none';
        }

        function showWithdrawTab() {
            document.getElementById('withdraw-content').style.display = 'block';
            document.getElementById('deposit-content').style.display = 'none';
            
            const depositTab = document.getElementById('deposit-tab');
            const withdrawTab = document.getElementById('withdraw-tab');
            
            withdrawTab.style.opacity = '1';
            withdrawTab.style.transform = 'translateY(-2px)';
            withdrawTab.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
            
            depositTab.style.opacity = '0.7';
            depositTab.style.transform = 'translateY(0)';
            depositTab.style.boxShadow = 'none';
            
            // Update balance in withdraw section
            const modalBalance = document.getElementById('modal-balance');
            if (modalBalance) {
                modalBalance.textContent = gameState.balance.toFixed(2);
            }
        }

        function submitDeposit() {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            const method = document.getElementById('deposit-method').value;
            
            if (isNaN(amount) || amount <= 0) {
                showToast('❌ Please enter a valid amount.');
                return;
            }
            
            if (amount < 20) {
                showToast('❌ Minimum deposit is 20 ETB.');
                return;
            }
            
            // Show loading state
            showToast('🔄 Processing deposit...');
            
            // Simulate processing delay
            setTimeout(() => {
                gameState.balance += amount;

                // Save balance to localStorage and sync to database
                localStorage.setItem('playerBalance', gameState.balance.toString());
                syncBalanceToDatabase();

                updateDisplay();
                
                // Update modal balance
                const modalBalance = document.getElementById('modal-balance');
                if (modalBalance) {
                    modalBalance.textContent = gameState.balance.toFixed(2);
                }
                
                closeDepositModal();
                showToast(`✅ ${amount.toFixed(2)} ETB deposited successfully via ${method}!`);
                
                // Clear form
                document.getElementById('deposit-amount').value = '';
            }, 2000);
        }

        function submitWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const account = document.getElementById('withdraw-account').value.trim();
            
            if (!account) {
                showToast('❌ Please enter your account number.');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                showToast('❌ Please enter a valid amount.');
                return;
            }
            
            if (amount < 20) {
                showToast('❌ Minimum withdrawal is 20 ETB.');
                return;
            }
            
            if (amount > 500) {
                showToast('❌ Maximum withdrawal is 500 ETB.');
                return;
            }
            
            if (amount > gameState.balance) {
                showToast('❌ Insufficient balance.');
                return;
            }
            
            // Show loading state
            showToast('🔄 Processing withdrawal...');
            
            // Simulate processing delay
            setTimeout(() => {
                gameState.balance -= amount;

                // Save balance to localStorage and sync to database
                localStorage.setItem('playerBalance', gameState.balance.toString());
                syncBalanceToDatabase();

                updateDisplay();
                
                // Update modal balance
                const modalBalance = document.getElementById('modal-balance');
                if (modalBalance) {
                    modalBalance.textContent = gameState.balance.toFixed(2);
                }
                
                closeDepositModal();
                showToast(`✅ ${amount.toFixed(2)} ETB withdrawal request submitted to ${account}!`);
                
                // Clear form
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('withdraw-account').value = '';
            }, 2000);
        }

        // Legacy functions (kept for compatibility)
        function toggleDropdown() {
            // Legacy function - now redirects to modal
            toggleDepositModal();
        }

        function deposit() {
            // Legacy function - simplified for quick deposit
            const amount = 100;
            gameState.balance += amount;
            updateDisplay();
            showToast(`✅ ${amount} ETB deposited successfully!`);
        }

        function showWithdraw() {
            // Legacy function - redirects to modal
            toggleDepositModal();
            setTimeout(() => showWithdrawTab(), 100);
        }

        function showPaymentMethods() {
            showToast('💳 Payment methods: Telebirr, Bank Transfer, Mobile Money');
        }

        function showMenu() {
            openSettings();
        }

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Sound functions
        function playSound(frequency, duration) {
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.log('Sound not available');
            }
        }

        function playWinSound() {
            setTimeout(() => playSound(523, 150), 0);
            setTimeout(() => playSound(659, 150), 150);
            setTimeout(() => playSound(784, 150), 300);
            setTimeout(() => playSound(1047, 300), 450);
        }

        function playLoseSound() {
            playSound(200, 500);
        }

        // Vibration function
        function vibrate(pattern) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        // Confetti animation
        function showConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confetti = [];
            const colors = ['#FFD700', '#FFA500', '#FF6347', '#FF1493', '#00CED1', '#32CD32', '#FF69B4', '#87CEEB', '#DDA0DD', '#F0E68C'];
            
            // Create confetti pieces
            for (let i = 0; i < 150; i++) {
                confetti.push({
                    x: canvas.width / 2,
                    y: canvas.height / 4,
                    vx: (Math.random() - 0.5) * 10,
                    vy: Math.random() * -15 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10
                });
            }
            
            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                let activeCount = 0;
                
                confetti.forEach(piece => {
                    piece.x += piece.vx;
                    piece.y += piece.vy;
                    piece.vy += 0.5; // gravity
                    piece.rotation += piece.rotationSpeed;
                    
                    if (piece.x < 0 || piece.x > canvas.width) {
                        piece.vx *= -0.8;
                    }
                    
                    if (piece.y < canvas.height + 50) {
                        activeCount++;
                        
                        ctx.save();
                        ctx.translate(piece.x, piece.y);
                        ctx.rotate((piece.rotation * Math.PI) / 180);
                        ctx.fillStyle = piece.color;
                        ctx.fillRect(-piece.size / 2, -piece.size / 2, piece.size, piece.size);
                        ctx.restore();
                    }
                });
                
                if (activeCount > 0) {
                    requestAnimationFrame(animateConfetti);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            
            animateConfetti();
        }

        // Tab Management Functions
        function switchTab(tabId) {
            // Remove active class from all tabs and panes
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Add active class to selected tab and pane
            document.getElementById(`${tabId}-tab`).classList.add('active');
            document.getElementById(`${tabId}-pane`).classList.add('active');
            
            // Populate content based on selected tab
            if (tabId === 'leaderboard') {
                populateLeaderboard();
            } else if (tabId === 'results') {
                populateResults();
            }
            
            // Play tab switch sound
            playSound(400, 100);
            vibrate(30);
        }

        // Populate Leaderboard Tab
        function populateLeaderboard() {
            const leaderboardTable = document.getElementById('leaderboard-table');
            
            // Generate fake leaderboard data
            const leaderboardData = generateLeaderboardData();
            
            let leaderboardHTML = '';
            leaderboardData.forEach((player, index) => {
                const rank = index + 1;
                const isTop5 = rank <= 5;
                
                leaderboardHTML += `
                    <div class="leaderboard-item ${isTop5 ? 'top-5' : ''}">
                        <div class="leaderboard-rank">${rank}</div>
                        <div class="leaderboard-player ${isTop5 ? 'top-5' : ''}">${player.name}</div>
                        <div class="leaderboard-amount">${player.winnings.toFixed(2)} ETB</div>
                    </div>
                `;
            });
            
            leaderboardTable.innerHTML = leaderboardHTML;
        }

        // Generate Leaderboard Data
        function generateLeaderboardData() {
            const players = [];
            const names = [
                'Ali*****23', 'Hel***_99', 'Sam****el', 'Bet****n', 'Daw****t', 'Yoh****s', 'Neb****h', 'Kem****u',
                'Lib****t', 'Bir****n', 'Shi****m', 'Wol****d', 'Tek****y', 'Emb****t', 'Fik****w', 'Asm****f',
                'Mah****m', 'Zer****u', 'Ros****l', 'Sim****n', 'Hun****t', 'Bal****h', 'Led****m', 'Tak****u',
                'Geb****w', 'Tes****e', 'Hen****k', 'Wub****u', 'Kal****e', 'Men****t', 'Zeh****r', 'Hab****u',
                'Sel****m', 'Tig****u', 'Abe****h', 'Yer****s', 'Nah****l', 'Bek****e', 'Dem****w', 'Fel****h',
                'Gir****a', 'Haw****u', 'Ism****l', 'Jal****e', 'Kab****r', 'Lem****h', 'Mek****s', 'Nag****u',
                'Oum****r', 'Pol****s', 'Qua****m', 'Rag****e', 'Sah****u', 'Tam****e', 'Umb****o', 'Ver****a',
                'Wak****e', 'Xav****r', 'Yab****h', 'Zak****s', 'Ada****h', 'Bru****o', 'Cat****a', 'Dan****l',
                'Eli****h', 'Fab****n', 'Gab****l', 'Han****h', 'Ire****e', 'Jos****h', 'Kal****b', 'Lea****r',
                'Mic****l', 'Noe****h', 'Oli****r', 'Pau****s', 'Que****n', 'Raf****l', 'Sar****h', 'Tom****s',
                'Urs****a', 'Vic****r', 'Wil****m', 'Xen****a', 'Yve****e', 'Zac****y', 'Alp****a', 'Bel****a',
                'Cha****s', 'Dia****a', 'Eva****a', 'Flo****a', 'Gra****e', 'Hil****a', 'Ire****a', 'Jam****s',
                'Kat****a', 'Lil****a', 'Mar****a', 'Nin****a', 'Oli****a', 'Pet****a', 'Qui****a', 'Rit****a',
                'Ste****a', 'Tin****a', 'Una****a', 'Val****a', 'Win****a', 'Xim****a', 'Yas****a', 'Zel****a'
            ];
            
            // Generate top 100 players with realistic Ethiopian gambling winnings
            for (let i = 0; i < 100; i++) {
                const name = names[i % names.length];
                let winnings;
                
                if (i < 3) {
                    // Top 3 players have very high winnings
                    winnings = Math.random() * 25000 + 15000; // 15k-40k ETB
                } else if (i < 10) {
                    // Top 10 have high winnings
                    winnings = Math.random() * 12000 + 5000; // 5k-17k ETB
                } else if (i < 25) {
                    // Top 25 have good winnings
                    winnings = Math.random() * 5000 + 2000; // 2k-7k ETB
                } else if (i < 50) {
                    // Top 50 have moderate winnings
                    winnings = Math.random() * 2000 + 500; // 500-2.5k ETB
                } else {
                    // Others have smaller winnings
                    winnings = Math.random() * 500 + 100; // 100-600 ETB
                }
                
                players.push({
                    name: name,
                    winnings: winnings
                });
            }
            
            // Sort by winnings (highest first)
            return players.sort((a, b) => b.winnings - a.winnings);
        }

        // Populate Results Tab
        function populateResults() {
            populateDrawnNumbers();
            populateWinnersFeed();
        }

        // Populate Drawn Numbers Display
        function populateDrawnNumbers() {
            const drawnBallsContainer = document.getElementById('results-drawn-balls');
            
            // Use last drawn numbers if available, otherwise generate fake ones
            let numbersToShow = [];
            if (gameState.drawnNumbers.length > 0) {
                numbersToShow = gameState.drawnNumbers.slice(0, 20);
            } else {
                // Generate fake drawn numbers for display
                const allNumbers = Array.from({length: 80}, (_, i) => i + 1);
                const shuffled = allNumbers.sort(() => Math.random() - 0.5);
                numbersToShow = shuffled.slice(0, 20);
            }
            
            let ballsHTML = '';
            numbersToShow.forEach((num, index) => {
                // Randomly make some balls "winning" (green) and others "losing" (red) for visual variety
                const isWinning = Math.random() > 0.5;
                ballsHTML += `
                    <div class="result-ball ${isWinning ? 'winning' : 'losing'}" style="animation-delay: ${index * 0.1}s">
                        ${num}
                    </div>
                `;
            });
            
            drawnBallsContainer.innerHTML = ballsHTML;
        }

        // Populate Winners Feed
        function populateWinnersFeed() {
            const winnersFeed = document.getElementById('winners-feed');
            
            // Generate fake recent winners
            const winners = generateRecentWinners();
            
            let winnersHTML = '';
            winners.forEach((winner, index) => {
                winnersHTML += `
                    <div class="winner-item" style="animation-delay: ${index * 0.2}s">
                        <div class="winner-avatar">${winner.avatar}</div>
                        <div class="winner-name">${winner.name}</div>
                        <div class="winner-amount">${winner.amount.toFixed(2)} ETB</div>
                    </div>
                `;
            });
            
            winnersFeed.innerHTML = winnersHTML;
        }

        // Generate Recent Winners Data
        function generateRecentWinners() {
            const winners = [];
            const names = [
                'Ali****23', 'Bet****n', 'Daw****t', 'Emb****t', 'Fik****w', 'Geb****w', 'Hel****99', 'Ism****l',
                'Jal****e', 'Kem****u', 'Lib****t', 'Mah****m', 'Neb****h', 'Oum****r', 'Pol****s', 'Ros****l'
            ];
            const avatars = ['🎯', '💎', '🔥', '⭐', '🏆', '💰', '🎊', '🎉'];
            
            // Generate 8-12 recent winners
            const winnerCount = Math.floor(Math.random() * 5) + 8;
            
            for (let i = 0; i < winnerCount; i++) {
                const name = names[Math.floor(Math.random() * names.length)];
                const avatar = avatars[Math.floor(Math.random() * avatars.length)];
                
                // Generate realistic win amounts
                let amount;
                if (Math.random() < 0.1) {
                    // 10% chance of big win
                    amount = Math.random() * 5000 + 1000; // 1k-6k ETB
                } else if (Math.random() < 0.3) {
                    // 30% chance of medium win
                    amount = Math.random() * 800 + 200; // 200-1k ETB
                } else {
                    // 60% chance of small win
                    amount = Math.random() * 200 + 50; // 50-250 ETB
                }
                
                winners.push({
                    name: name,
                    avatar: avatar,
                    amount: amount
                });
            }
            
            return winners;
        }

        // Auto-refresh Results Tab Content
        function startResultsAutoRefresh() {
            setInterval(() => {
                // Only refresh if Results tab is active
                const resultsPane = document.getElementById('results-pane');
                if (resultsPane && resultsPane.classList.contains('active')) {
                    populateResults();
                }
            }, 15000); // Refresh every 15 seconds
        }

        // Chapa Payment Integration
        function initializeChapa() {
            const amountInput = document.getElementById('deposit-amount');
            const selectedMethodElement = document.querySelector('.payment-method.selected');
            const amount = parseFloat(amountInput.value) || 5;
            
            if (amount < 5) {
                showToast('❌ Minimum deposit is 5 ETB');
                return;
            }

            // Get selected payment methods
            const availablePaymentMethods = [];
            if (selectedMethodElement) {
                const method = selectedMethodElement.getAttribute('data-method');
                availablePaymentMethods.push(method);
            } else {
                // Default to all methods if none selected
                availablePaymentMethods.push('telebirr', 'cbebirr', 'ebirr', 'mpesa');
            }

            const chapa = new ChapaCheckout({
                publicKey: 'CHAPUBK_TEST-HbYr8RhzEbxGcD3TBjRPa5rk6ahGwyfA',
                amount: amount,
                currency: 'ETB',
                availablePaymentMethods: availablePaymentMethods,
                customizations: {
                    buttonText: 'Pay Now',
                    styles: `
                        .chapa-pay-button { 
                            background: linear-gradient(135deg, #15aabf, #1098f7); 
                            color: white;
                            font-weight: bold;
                            padding: 14px 24px;
                            border-radius: 8px;
                            border: none;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            width: 100%;
                            font-size: 16px;
                        }
                        .chapa-pay-button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(21, 170, 191, 0.4);
                        }
                    `
                },
                callbackUrl: 'https://yourdomain.com/callback',
                returnUrl: 'https://yourdomain.com/success',
                onSuccess: function(response) {
                    console.log('Payment successful:', response);
                    // Update user balance
                    gameState.balance += amount;
                    updateDisplay();
                    closeDepositModal();
                    showToast(`✅ ${amount.toFixed(2)} ETB deposited successfully!`);
                },
                onError: function(error) {
                    console.error('Payment failed:', error);
                    showToast('❌ Payment failed. Please try again.');
                },
                onClose: function() {
                    console.log('Payment modal closed');
                    showToast('Payment cancelled');
                }
            });

            // Show the Chapa payment form
            const paymentFormContainer = document.getElementById('chapa-payment-form');
            paymentFormContainer.style.display = 'block';
            paymentFormContainer.innerHTML = '<div id="chapa-inline-form"></div>';
            
            try {
                chapa.initialize('chapa-inline-form');
                showToast('💳 Initializing payment...');
            } catch (error) {
                console.error('Chapa initialization error:', error);
                showToast('❌ Payment system error. Please try again.');
                paymentFormContainer.style.display = 'none';
            }
        }

        // Payment method selection function
        function selectPaymentMethod(method) {
            // Remove selected class from all payment methods
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selected class to clicked method
            const selectedElement = document.querySelector(`[data-method="${method}"]`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            // Hide payment form when changing method
            const paymentFormContainer = document.getElementById('chapa-payment-form');
            paymentFormContainer.style.display = 'none';
            paymentFormContainer.innerHTML = '';
            
            showToast(`Selected: ${method.charAt(0).toUpperCase() + method.slice(1)}`);
        }

        // Alternative function for opening deposit (compatibility)
        function openDeposit() {
            toggleDepositModal();
        }

        // Alternative function for closing deposit (compatibility) 
        function closeDeposit() {
            closeDepositModal();
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            initAuth();
            initBackendIntegration();
            initBackgroundMusic();
            // Initialize tab content
            populateLeaderboard();
            populateResults();
            startResultsAutoRefresh();
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('confetti-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Handle touch events for better mobile experience
        document.addEventListener('touchstart', function() {
            // Initialize audio context on first user interaction (required by some browsers)
            if (!audioContext) {
                initAudio();
            }
        }, { once: true });

        // Authentication System Functions
        function switchAuthTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
            
            playSound(400, 100);
            vibrate(30);
        }

        function validateEthiopianPhone(phone) {
            // Ethiopian phone number validation: starts with 09 and has 10 digits total
            const phoneRegex = /^09\d{8}$/;
            return phoneRegex.test(phone);
        }

        // Enhanced phone validation with better error messages
        function validatePhoneWithMessage(phone) {
            if (!phone) {
                return { valid: false, message: 'Phone number is required' };
            }
            
            if (!/^09\d{8}$/.test(phone)) {
                return { valid: false, message: 'Please enter a valid Ethiopian phone number (09xxxxxxxx)' };
            }
            
            return { valid: true, message: '' };
        }

        function handleLogin() {
            const name = document.getElementById('login-name').value.trim();
            const phone = document.getElementById('login-phone').value.trim();
            
            if (!name) {
                showToast('❌ Please enter your name');
                return;
            }
            
            const phoneValidation = validatePhoneWithMessage(phone);
            if (!phoneValidation.valid) {
                showToast(`❌ ${phoneValidation.message}`);
                return;
            }
            
            // Show loading state
            const loginBtn = document.getElementById('login-btn');
            loginBtn.innerHTML = '<span class="button-text">🔄 Logging in...</span><div class="button-shine"></div>';
            loginBtn.disabled = true;
            
            // Call backend API
            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'login',
                    name: name,
                    phone: phone
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store user data
                    localStorage.setItem('playerName', data.player.username);
                    localStorage.setItem('playerPhone', data.player.phone);
                    localStorage.setItem('playerId', data.player.id);
                    localStorage.setItem('isLoggedIn', 'true');
                    
                    // Update game state
                    gameState.balance = parseFloat(data.player.balance);

                    // Save balance to localStorage
                    localStorage.setItem('playerBalance', data.player.balance);
                    localStorage.setItem('lastKnownDbBalance', data.player.balance);

                    updateDisplay();
                    
                    // Update header to show user info
                    updateHeaderForLoggedInUser(data.player.username);
                    
                    // Hide auth modal and show game
                    closeAuthModal();
                    
                    showToast(`🎮 Welcome back, ${data.player.username}!`);
                    playWinSound();
                    vibrate([100, 50, 100]);
                } else {
                    showToast(`❌ ${data.message}`);
                    loginBtn.innerHTML = '<span class="button-text">🎮 Start Playing</span><div class="button-shine"></div>';
                    loginBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                showToast('❌ Login failed. Please try again.');
                loginBtn.innerHTML = '<span class="button-text">🎮 Start Playing</span><div class="button-shine"></div>';
                loginBtn.disabled = false;
            });
        }

        function handleRegister() {
            const name = document.getElementById('register-name').value.trim();
            const phone = document.getElementById('register-phone').value.trim();
            
            if (!name) {
                showToast('❌ Please enter your full name');
                return;
            }
            
            const phoneValidation = validatePhoneWithMessage(phone);
            if (!phoneValidation.valid) {
                showToast(`❌ ${phoneValidation.message}`);
                return;
            }
            
            // Show loading state
            const registerBtn = document.getElementById('register-btn');
            registerBtn.innerHTML = '<span class="button-text">🔄 Creating account...</span><div class="button-shine"></div>';
            registerBtn.disabled = true;
            
            // Call backend API
            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'register',
                    name: name,
                    phone: phone
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store user data
                    localStorage.setItem('playerName', data.player.username);
                    localStorage.setItem('playerPhone', data.player.phone);
                    localStorage.setItem('playerId', data.player.id);
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('isNewUser', 'true');
                    
                    // Update game state
                    gameState.balance = parseFloat(data.player.balance);

                    // Save balance to localStorage
                    localStorage.setItem('playerBalance', data.player.balance);
                    localStorage.setItem('lastKnownDbBalance', data.player.balance);

                    updateDisplay();
                    
                    // Update header to show user info
                    updateHeaderForLoggedInUser(data.player.username);
                    
                    // Hide auth modal and show welcome modal
                    closeAuthModal();
                    showWelcomeModal();
                    
                    // Play celebration sounds
                    playWinSound();
                    vibrate([200, 100, 200, 100, 300]);
                    
                    // Show confetti
                    setTimeout(() => showConfetti(), 500);
                } else {
                    showToast(`❌ ${data.message}`);
                    registerBtn.innerHTML = '<span class="button-text">🎉 Register & Get Bonus</span><div class="button-shine"></div>';
                    registerBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Registration error:', error);
                showToast('❌ Registration failed. Please try again.');
                registerBtn.innerHTML = '<span class="button-text">🎉 Register & Get Bonus</span><div class="button-shine"></div>';
                registerBtn.disabled = false;
            });
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.remove('active');
        }

        // Logout function
        function logout() {
            // Clear all authentication data
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('playerName');
            localStorage.removeItem('playerPhone');
            localStorage.removeItem('playerId');
            localStorage.removeItem('isNewUser');
            
            // Reset game state
            gameState.balance = 0;
            gameState.selectedNumbers = [];
            gameState.gameHistory = [];
            
            // Update display
            updateDisplay();
            
            // Update header to show login button
            updateHeaderForLoggedOutUser();
            
            // Show auth modal
            document.getElementById('auth-modal').classList.add('active');
            switchAuthTab('register');
            
            showToast('🚪 You have been logged out');
        }

        function showWelcomeModal() {
            document.getElementById('welcome-modal').classList.add('active');
        }

        function showAuthModal() {
            const authModal = document.getElementById('auth-modal');
            if (authModal) {
                authModal.classList.add('active');
                switchAuthTab('register');
                showToast('📝 Please login or register to continue');
            } else {
                showToast('❌ Login modal not found. Please refresh the page.');
            }
        }

        function closeWelcomeModal() {
            document.getElementById('welcome-modal').classList.remove('active');
        }

        function showHowToPlay() {
            closeWelcomeModal();
            document.getElementById('how-to-play-modal').classList.add('active');
        }

        function closeHowToPlayModal() {
            document.getElementById('how-to-play-modal').classList.remove('active');
        }

        // Check if user is already logged in
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const playerName = localStorage.getItem('playerName');
            const playerId = localStorage.getItem('playerId');
            
            if (isLoggedIn === 'true' && playerName && playerId) {
                // User is already logged in, hide auth modal
                closeAuthModal();
                
                // Update header to show user info
                updateHeaderForLoggedInUser(playerName);
                
                // Load user data from backend
                loadUserData(playerId);
                
                // Sync local history with backend data
                syncHistoryWithBackend(playerId);
                
                // Check if they're a new user who hasn't seen the welcome modal
                const isNewUser = localStorage.getItem('isNewUser');
                if (isNewUser === 'true') {
                    // Clear the new user flag
                    localStorage.removeItem('isNewUser');
                    
                    // Show welcome modal with the bonus
                    setTimeout(() => {
                        showWelcomeModal();
                    }, 1000);
                }
                
                showToast(`👋 Welcome back, ${playerName}!`);
            } else {
                // Show auth modal - ensure it's visible
                const authModal = document.getElementById('auth-modal');
                authModal.classList.add('active');
                
                // Update header to show login button
                updateHeaderForLoggedOutUser();
                
                // Set default tab to register for new users
                switchAuthTab('register');
            }
        }

        // Update header for logged in user
        function updateHeaderForLoggedInUser(playerName) {
            const loginBtn = document.getElementById('header-login-btn');
            const depositBtn = document.getElementById('deposit-withdraw-btn');

            // Hide login button, show deposit button
            if (loginBtn) loginBtn.style.display = 'none';
            if (depositBtn) depositBtn.style.display = 'block';
        }

        // Update header for logged out user
        function updateHeaderForLoggedOutUser() {
            const loginBtn = document.getElementById('header-login-btn');
            const depositBtn = document.getElementById('deposit-withdraw-btn');

            // Show login button, hide deposit button
            if (loginBtn) loginBtn.style.display = 'block';
            if (depositBtn) depositBtn.style.display = 'none';
        }
        
        // Load user data from backend
        function loadUserData(playerId) {
            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'load_game',
                    player_id: playerId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.player) {
                    // Update game state with fresh database data
                    gameState.balance = parseFloat(data.player.balance);

                    // Store fresh data in localStorage
                    localStorage.setItem('playerBalance', data.player.balance);
                    localStorage.setItem('playerName', data.player.username);
                    localStorage.setItem('playerPhone', data.player.phone);

                    // Store database balance as last known balance for conflict detection
                    localStorage.setItem('lastKnownDbBalance', data.player.balance);

                    updateDisplay();

                    // Load game history from backend
                    loadGameHistoryFromBackend(playerId);

                    console.log('User data loaded successfully. Balance:', data.player.balance);
                } else {
                    console.error('Failed to load user data:', data.message);
                    // If player not found, logout
                    if (data.message && data.message.includes('not found')) {
                        logout();
                    }
                }
            })
            .catch(error => {
                console.error('Error loading user data:', error);
                // Use cached data as fallback
                const savedBalance = localStorage.getItem('playerBalance');
                if (savedBalance) {
                    gameState.balance = parseFloat(savedBalance);
                    updateDisplay();
                }
            });
        }

        // Load complete game history from backend
        function loadGameHistoryFromBackend(playerId) {
            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'get_history',
                    player_id: playerId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.history) {
                    // Convert backend history format to frontend format
                    gameState.gameHistory = data.history.map(item => ({
                        id: item.id || Date.now(),
                        timestamp: new Date(item.game_date).toLocaleString(),
                        selectedNumbers: item.selected_numbers || [],
                        drawnNumbers: item.drawn_numbers || [],
                        matches: parseInt(item.match_count) || 0,
                        betAmount: parseFloat(item.bet_amount) || 0,
                        winAmount: parseFloat(item.win_amount) || 0,
                        riskLevel: 'Medium' // Default risk level
                    }));
                    
                    console.log('✅ Game history loaded from backend:', gameState.gameHistory.length, 'entries');
                } else {
                    console.log('No game history found or error loading history');
                }
            })
            .catch(error => {
                console.error('Error loading game history:', error);
            });
        }

        // Refresh game history manually
        function refreshGameHistory() {
            const playerId = localStorage.getItem('playerId');
            if (playerId) {
                showToast('🔄 Refreshing game history...');
                loadGameHistoryFromBackend(playerId);
                setTimeout(() => {
                    updateHistoryDisplay();
                    showToast('✅ Game history refreshed');
                }, 500);
            } else {
                showToast('❌ Please log in to refresh history');
            }
        }

        // Sync local history with backend data
        function syncHistoryWithBackend(playerId) {
            // Load backend history and merge with any local unsaved data
            loadGameHistoryFromBackend(playerId);
            
            // Check if there are any local games that haven't been saved to backend
            const unsavedGames = gameState.gameHistory.filter(game => !game.savedToBackend);
            if (unsavedGames.length > 0) {
                console.log('🔄 Syncing', unsavedGames.length, 'unsaved games to backend...');
                unsavedGames.forEach(game => {
                    // Save each unsaved game to backend
                    const gameData = {
                        action: 'save_history',
                        player_id: playerId,
                        selected_numbers: JSON.stringify(game.selectedNumbers),
                        drawn_numbers: JSON.stringify(game.drawnNumbers),
                        bet_amount: game.betAmount,
                        win_amount: game.winAmount,
                        match_count: game.matches
                    };
                    
                    fetch('api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(gameData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            game.savedToBackend = true;
                            console.log('✅ Synced game to backend');
                        }
                    })
                    .catch(error => {
                        console.error('Error syncing game to backend:', error);
                    });
                });
            }
        }

        // Phone number input formatting
        function formatPhoneInput(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
                    
                    // Ensure it starts with 09
                    if (value.length > 0 && !value.startsWith('09')) {
                        if (value.startsWith('9')) {
                            value = '0' + value;
                        } else if (!value.startsWith('0')) {
                            value = '09' + value;
                        }
                    }
                    
                    // Limit to 10 digits
                    if (value.length > 10) {
                        value = value.substring(0, 10);
                    }
                    
                    e.target.value = value;
                });
            }
        }

        // Initialize authentication system
        function initAuth() {
            // Format phone inputs
            formatPhoneInput('login-phone');
            formatPhoneInput('register-phone');
            
            // Check authentication status
            checkAuthStatus();
        }

        // ===== ADMIN FUNCTIONS =====
        
        // Show admin access modal
        function showAdminAccess() {
            document.getElementById('admin-modal').classList.add('active');
        }
        
        // Close admin modal
        function closeAdminModal() {
            document.getElementById('admin-modal').classList.remove('active');
        }
        
        // Admin login
        function adminLogin() {
            const password = document.getElementById('admin-password').value;
            
            if (!password) {
                showToast('❌ Please enter admin password');
                return;
            }
            
            // Simple admin authentication (matches admin-enhanced.php)
            if (password === 'admin123') {
                document.getElementById('admin-login-form').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                showToast('🔐 Admin access granted');
            } else {
                showToast('❌ Invalid admin password');
            }
        }
        
        // Admin logout
        function adminLogout() {
            document.getElementById('admin-login-form').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-password').value = '';
            showToast('🚪 Admin logged out');
        }
        
        // Open admin panel in new window
        function openAdminPanel(adminFile) {
            const adminUrl = `${window.location.origin}/${adminFile}`;
            window.open(adminUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
        }

        // New Header Functions
        function toggleDepositModal() {
            const modal = document.getElementById('deposit-modal');
            if (modal.style.display === 'flex') {
                closeDepositModal();
            } else {
                openDepositModal();
            }
        }

        function openDepositModal() {
            const modal = document.getElementById('deposit-modal');
            modal.style.display = 'flex';
            modal.classList.add('show');

            // Update modal balance
            const modalBalance = document.getElementById('modal-balance');
            if (modalBalance) {
                modalBalance.textContent = gameState.balance.toFixed(2);
            }
        }

        function closeDepositModal() {
            const modal = document.getElementById('deposit-modal');
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        function showDepositTab() {
            // Update tab buttons
            document.getElementById('deposit-tab').classList.add('active');
            document.getElementById('withdraw-tab').classList.remove('active');
            document.getElementById('deposit-tab').style.opacity = '1';
            document.getElementById('withdraw-tab').style.opacity = '0.7';

            // Show/hide content
            document.getElementById('deposit-content').style.display = 'block';
            document.getElementById('withdraw-content').style.display = 'none';
        }

        function showWithdrawTab() {
            // Update tab buttons
            document.getElementById('withdraw-tab').classList.add('active');
            document.getElementById('deposit-tab').classList.remove('active');
            document.getElementById('withdraw-tab').style.opacity = '1';
            document.getElementById('deposit-tab').style.opacity = '0.7';

            // Show/hide content
            document.getElementById('withdraw-content').style.display = 'block';
            document.getElementById('deposit-content').style.display = 'none';
        }

        function selectPaymentMethod(method) {
            // Remove selected class from all payment methods
            document.querySelectorAll('.payment-method').forEach(pm => {
                pm.classList.remove('selected');
            });

            // Add selected class to clicked method
            document.querySelector(`[data-method="${method}"]`).classList.add('selected');
        }

        function initializeChapa() {
            const amount = document.getElementById('deposit-amount').value;
            const selectedMethod = document.querySelector('.payment-method.selected').dataset.method;

            if (!amount || amount < 5) {
                showToast('❌ Minimum deposit is 5 ETB');
                return;
            }

            // Simulate payment process
            showToast('💳 Redirecting to payment...');

            // Simulate successful payment after 2 seconds
            setTimeout(() => {
                const depositAmount = parseFloat(amount);
                gameState.balance += depositAmount;
                localStorage.setItem('playerBalance', gameState.balance.toString());
                updateDisplay();
                closeDepositModal();
                showToast(`✅ Successfully deposited ${depositAmount} ETB via ${selectedMethod}`);

                // Sync to database
                if (typeof syncBalanceToDatabase === 'function') {
                    syncBalanceToDatabase();
                }
            }, 2000);
        }

        function submitWithdraw() {
            const account = document.getElementById('withdraw-account').value;
            const amount = parseFloat(document.getElementById('withdraw-amount').value);

            if (!account) {
                showToast('❌ Please enter account number');
                return;
            }

            if (!amount || amount < 20) {
                showToast('❌ Minimum withdrawal is 20 ETB');
                return;
            }

            if (amount > gameState.balance) {
                showToast('❌ Insufficient balance');
                return;
            }

            if (amount > 500) {
                showToast('❌ Maximum withdrawal is 500 ETB');
                return;
            }

            // Process withdrawal
            gameState.balance -= amount;
            localStorage.setItem('playerBalance', gameState.balance.toString());
            updateDisplay();
            closeDepositModal();
            showToast(`✅ Withdrawal of ${amount} ETB submitted to ${account}`);

            // Sync to database
            if (typeof syncBalanceToDatabase === 'function') {
                syncBalanceToDatabase();
            }
        }

        function openSettings() {
            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const playerName = localStorage.getItem('playerName') || 'Guest';
            const isMusicEnabled = localStorage.getItem('backgroundMusic') !== 'false';

            // Create beautiful settings modal
            const settingsModal = `
                <div class="modal settings-modal" id="settings-modal" onclick="event.target === this && closeSettingsModal()">
                    <div class="modal-content settings-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h2 class="modal-title">⚙️ Settings</h2>
                            <button class="modal-close" onclick="closeSettingsModal()">×</button>
                        </div>
                        <div class="modal-body">
                            ${isLoggedIn ? `
                                <div class="settings-user-info">
                                    <div class="user-avatar-large">${playerName.charAt(0).toUpperCase()}</div>
                                    <div class="user-details">
                                        <div class="user-name-large">${playerName}</div>
                                        <div class="user-status">✅ Logged In</div>
                                    </div>
                                </div>
                            ` : `
                                <div class="settings-login-prompt">
                                    <div class="login-icon">👤</div>
                                    <div class="login-text">Not logged in</div>
                                    <button class="settings-btn login-settings-btn" onclick="showAuthModal(); closeSettingsModal();">
                                        🔑 Login / Register
                                    </button>
                                </div>
                            `}

                            <div class="settings-section">
                                <div class="settings-item">
                                    <div class="settings-item-info">
                                        <div class="settings-item-title">🎵 Background Music</div>
                                        <div class="settings-item-desc">Relaxing piano music</div>
                                    </div>
                                    <div class="toggle-switch ${isMusicEnabled ? 'active' : ''}" onclick="toggleBackgroundMusic()">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>

                                <div class="settings-item" onclick="showGameHistory(); closeSettingsModal();">
                                    <div class="settings-item-info">
                                        <div class="settings-item-title">📊 Game History</div>
                                        <div class="settings-item-desc">View your past games</div>
                                    </div>
                                    <div class="settings-arrow">›</div>
                                </div>

                                <div class="settings-item" onclick="showContactModal(); closeSettingsModal();">
                                    <div class="settings-item-info">
                                        <div class="settings-item-title">📞 Contact Us</div>
                                        <div class="settings-item-desc">Get help and support</div>
                                    </div>
                                    <div class="settings-arrow">›</div>
                                </div>

                                <div class="settings-item" onclick="showTermsModal(); closeSettingsModal();">
                                    <div class="settings-item-info">
                                        <div class="settings-item-title">📋 Terms & Conditions</div>
                                        <div class="settings-item-desc">Legal information</div>
                                    </div>
                                    <div class="settings-arrow">›</div>
                                </div>

                                <div class="settings-item" onclick="showFairPlayModal(); closeSettingsModal();">
                                    <div class="settings-item-info">
                                        <div class="settings-item-title">🎯 Fair Play Check</div>
                                        <div class="settings-item-desc">Game fairness verification</div>
                                    </div>
                                    <div class="settings-arrow">›</div>
                                </div>
                            </div>

                            ${isLoggedIn ? `
                                <div class="settings-logout">
                                    <button class="settings-btn logout-settings-btn" onclick="logout(); closeSettingsModal();">
                                        🚪 Logout
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;

            // Remove existing settings modal
            const existingModal = document.getElementById('settings-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // Add new settings modal
            document.body.insertAdjacentHTML('beforeend', settingsModal);

            // Show modal
            setTimeout(() => {
                document.getElementById('settings-modal').style.display = 'flex';
            }, 10);
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settings-modal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Background Music Functions
        let musicPlaying = false;
        let musicInterval = null;

        function initBackgroundMusic() {
            // Check if music should be enabled
            const musicEnabled = localStorage.getItem('backgroundMusic') !== 'false';
            if (musicEnabled) {
                // Try to start music immediately
                setTimeout(() => {
                    startBackgroundMusic();
                }, 1000);

                // Also start music after first user interaction as fallback
                document.addEventListener('click', startBackgroundMusic, { once: true });
                document.addEventListener('touchstart', startBackgroundMusic, { once: true });
            }
        }

        function startBackgroundMusic() {
            if (musicPlaying) return;

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                playRelaxingMelody();
                musicPlaying = true;

                // Show music indicator
                const musicIndicator = document.getElementById('music-indicator');
                if (musicIndicator) {
                    musicIndicator.style.display = 'block';
                }
            } catch (error) {
                console.log('Audio not supported');
            }
        }

        function playRelaxingMelody() {
            if (!audioContext) return;

            // Extended relaxing piano melody - more soothing and longer
            const melody = [
                // First phrase - peaceful opening
                { note: 261.63, duration: 1200 }, // C4
                { note: 293.66, duration: 800 },  // D4
                { note: 329.63, duration: 800 },  // E4
                { note: 349.23, duration: 1200 }, // F4
                { note: 329.63, duration: 600 },  // E4
                { note: 293.66, duration: 600 },  // D4
                { note: 261.63, duration: 1800 }, // C4
                { note: 0, duration: 600 },       // Rest

                // Second phrase - gentle rise
                { note: 220.00, duration: 1200 }, // A3
                { note: 246.94, duration: 600 },  // B3
                { note: 261.63, duration: 600 },  // C4
                { note: 293.66, duration: 1200 }, // D4
                { note: 261.63, duration: 600 },  // C4
                { note: 246.94, duration: 600 },  // B3
                { note: 220.00, duration: 1800 }, // A3
                { note: 0, duration: 800 },       // Rest

                // Third phrase - higher register, dreamy
                { note: 392.00, duration: 1000 }, // G4
                { note: 440.00, duration: 600 },  // A4
                { note: 493.88, duration: 600 },  // B4
                { note: 523.25, duration: 1200 }, // C5
                { note: 493.88, duration: 600 },  // B4
                { note: 440.00, duration: 600 },  // A4
                { note: 392.00, duration: 1600 }, // G4
                { note: 0, duration: 800 },       // Rest

                // Fourth phrase - gentle conclusion
                { note: 349.23, duration: 1200 }, // F4
                { note: 329.63, duration: 800 },  // E4
                { note: 293.66, duration: 800 },  // D4
                { note: 261.63, duration: 2400 }, // C4 - long peaceful end
                { note: 0, duration: 1200 },      // Long rest
            ];

            let currentNote = 0;

            function playNextNote() {
                if (!musicPlaying || !audioContext) return;

                const note = melody[currentNote];

                if (note.note > 0) {
                    // Create oscillator for soft piano-like sound
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(note.note, audioContext.currentTime);
                    oscillator.type = 'triangle'; // Softer than sine

                    // Very gentle piano-like envelope
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.02); // Softer volume
                    gainNode.gain.exponentialRampToValueAtTime(0.005, audioContext.currentTime + note.duration / 1000);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + note.duration / 1000);
                }

                currentNote = (currentNote + 1) % melody.length;

                setTimeout(playNextNote, note.duration);
            }

            // Show a toast when music starts
            if (currentNote === 0) {
                showToast('🎵 Relaxing music started');
            }

            playNextNote();
        }

        function toggleBackgroundMusic() {
            const toggle = document.querySelector('.toggle-switch');
            const musicIndicator = document.getElementById('music-indicator');
            if (!toggle) return;

            const isEnabled = toggle.classList.contains('active');

            if (isEnabled) {
                // Disable music
                toggle.classList.remove('active');
                localStorage.setItem('backgroundMusic', 'false');
                musicPlaying = false;
                if (audioContext) {
                    audioContext.close();
                    audioContext = null;
                }
                if (musicIndicator) {
                    musicIndicator.style.display = 'none';
                }
                showToast('🔇 Background music disabled');
            } else {
                // Enable music
                toggle.classList.add('active');
                localStorage.setItem('backgroundMusic', 'true');
                if (!musicPlaying) {
                    startBackgroundMusic();
                }
                showToast('🎵 Background music enabled');
            }
        }

        // Modal Functions
        function showContactModal() {
            const contactModal = `
                <div class="modal" id="contact-modal" onclick="event.target === this && closeContactModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h2 class="modal-title">📞 Contact Us</h2>
                            <button class="modal-close" onclick="closeContactModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <div style="font-size: 48px; margin-bottom: 10px;">📞</div>
                                <h3 style="color: white; margin-bottom: 20px;">Get Help & Support</h3>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">📧</div>
                                <div class="contact-info">
                                    <div class="contact-title">Email Support</div>
                                    <div class="contact-detail">support@251keno.com</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">📱</div>
                                <div class="contact-info">
                                    <div class="contact-title">Phone Support</div>
                                    <div class="contact-detail">+251 911 123 456</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">💬</div>
                                <div class="contact-info">
                                    <div class="contact-title">Live Chat</div>
                                    <div class="contact-detail">Available 24/7</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">🕒</div>
                                <div class="contact-info">
                                    <div class="contact-title">Support Hours</div>
                                    <div class="contact-detail">24/7 Customer Service</div>
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 20px;">
                                <button class="settings-btn login-settings-btn" onclick="closeContactModal()">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', contactModal);
            setTimeout(() => {
                document.getElementById('contact-modal').style.display = 'flex';
            }, 10);
        }

        function closeContactModal() {
            const modal = document.getElementById('contact-modal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function showTermsModal() {
            const termsModal = `
                <div class="modal" id="terms-modal" onclick="event.target === this && closeTermsModal()">
                    <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 500px;">
                        <div class="modal-header">
                            <h2 class="modal-title">📋 Terms & Conditions</h2>
                            <button class="modal-close" onclick="closeTermsModal()">×</button>
                        </div>
                        <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                            <div style="color: rgba(255,255,255,0.9); line-height: 1.6;">
                                <h3 style="color: #40c057; margin-bottom: 15px;">1. Acceptance of Terms</h3>
                                <p style="margin-bottom: 15px;">By using 251KENO, you agree to these terms and conditions. If you do not agree, please do not use our service.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">2. Eligibility</h3>
                                <p style="margin-bottom: 15px;">You must be 18 years or older to play. By registering, you confirm you meet this requirement.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">3. Fair Play</h3>
                                <p style="margin-bottom: 15px;">All games use certified random number generators. We ensure fair and transparent gameplay for all users.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">4. Responsible Gaming</h3>
                                <p style="margin-bottom: 15px;">Please play responsibly. Set limits and never bet more than you can afford to lose.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">5. Account Security</h3>
                                <p style="margin-bottom: 15px;">Keep your account information secure. You are responsible for all activities under your account.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">6. Payments</h3>
                                <p style="margin-bottom: 15px;">All transactions are processed securely. Withdrawals are processed within 24 hours.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">7. Privacy</h3>
                                <p style="margin-bottom: 15px;">We protect your personal information and never share it with third parties without consent.</p>

                                <h3 style="color: #40c057; margin-bottom: 15px;">8. Changes to Terms</h3>
                                <p style="margin-bottom: 15px;">We may update these terms. Continued use constitutes acceptance of new terms.</p>
                            </div>

                            <div style="text-align: center; margin-top: 20px;">
                                <button class="settings-btn login-settings-btn" onclick="closeTermsModal()">
                                    I Understand
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', termsModal);
            setTimeout(() => {
                document.getElementById('terms-modal').style.display = 'flex';
            }, 10);
        }

        function closeTermsModal() {
            const modal = document.getElementById('terms-modal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function showFairPlayModal() {
            const fairPlayModal = `
                <div class="modal" id="fairplay-modal" onclick="event.target === this && closeFairPlayModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h2 class="modal-title">🎯 Fair Play Check</h2>
                            <button class="modal-close" onclick="closeFairPlayModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <div style="font-size: 48px; margin-bottom: 10px;">🎯</div>
                                <h3 style="color: white; margin-bottom: 20px;">Game Fairness Verification</h3>
                            </div>

                            <div class="fairplay-item">
                                <div class="fairplay-icon">🔒</div>
                                <div class="fairplay-info">
                                    <div class="fairplay-title">Certified RNG</div>
                                    <div class="fairplay-detail">✅ Verified Random Number Generator</div>
                                </div>
                            </div>

                            <div class="fairplay-item">
                                <div class="fairplay-icon">🛡️</div>
                                <div class="fairplay-info">
                                    <div class="fairplay-title">Blockchain Verified</div>
                                    <div class="fairplay-detail">✅ Transparent & Immutable Results</div>
                                </div>
                            </div>

                            <div class="fairplay-item">
                                <div class="fairplay-icon">📊</div>
                                <div class="fairplay-info">
                                    <div class="fairplay-title">Audit Reports</div>
                                    <div class="fairplay-detail">✅ Regular Third-Party Audits</div>
                                </div>
                            </div>

                            <div class="fairplay-item">
                                <div class="fairplay-icon">🎲</div>
                                <div class="fairplay-info">
                                    <div class="fairplay-title">Provably Fair</div>
                                    <div class="fairplay-detail">✅ Verify Each Game Result</div>
                                </div>
                            </div>

                            <div style="background: rgba(64, 192, 87, 0.1); border: 1px solid #40c057; border-radius: 10px; padding: 15px; margin: 20px 0; text-align: center;">
                                <div style="color: #40c057; font-weight: bold; margin-bottom: 5px;">Current Game Seed:</div>
                                <div style="color: white; font-family: monospace; font-size: 12px; word-break: break-all;">
                                    ${Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)}
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 20px;">
                                <button class="settings-btn login-settings-btn" onclick="closeFairPlayModal()">
                                    Verified ✅
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', fairPlayModal);
            setTimeout(() => {
                document.getElementById('fairplay-modal').style.display = 'flex';
            }, 10);
        }

        function closeFairPlayModal() {
            const modal = document.getElementById('fairplay-modal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        // Open database migration
        function openDatabaseMigration() {
            const migrateUrl = `${window.location.origin}/migrate-database.php`;
            window.open(migrateUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        // Test backend functionality
        function testBackend() {
            const testUrl = `${window.location.origin}/test-backend.php`;
            window.open(testUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
        
        // Test database connection
        function testDatabaseConnection() {
            fetch('api.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'test_connection' })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('✅ Database connection successful');
                } else {
                    showToast('❌ Database connection failed: ' + data.message);
                }
            })
            .catch(error => {
                showToast('❌ Database connection error: ' + error.message);
            });
        }
        
        // Open detailed database test
        function openDetailedDatabaseTest() {
            const testUrl = `${window.location.origin}/test-database.php`;
            window.open(testUrl, '_blank', 'width=1000,height=800,scrollbars=yes,resizable=yes');
        }
        
        // ===== ENHANCED API INTEGRATION =====
        
        // Load game content from game-content.php
        function loadGameContent() {
            fetch('game-content.php')
                .then(response => response.text())
                .then(html => {
                    // Parse and integrate game content
                    console.log('Game content loaded from backend');
                })
                .catch(error => {
                    console.error('Error loading game content:', error);
                });
        }
        
        // Check backend health
        function checkBackendHealth() {
            const endpoints = [
                'api.php',
                'admin.php', 
                'admin-enhanced.php',
                'game-content.php',
                'migrate-database.php',
                'test-backend.php',
                'config.php'
            ];
            
            let healthyCount = 0;
            let totalCount = endpoints.length;
            
            endpoints.forEach(endpoint => {
                fetch(endpoint)
                    .then(response => {
                        if (response.ok) {
                            console.log(`✅ ${endpoint} is accessible`);
                            healthyCount++;
                            updateBackendHealthStatus(healthyCount, totalCount);
                        } else {
                            console.warn(`⚠️ ${endpoint} returned status ${response.status}`);
                        }
                    })
                    .catch(error => {
                        console.error(`❌ ${endpoint} is not accessible:`, error);
                    });
            });
        }
        
        // Update backend health status
        function updateBackendHealthStatus(healthy, total) {
            const status = `${healthy}/${total} endpoints healthy`;
            if (healthy === total) {
                showToast(`✅ Backend Health: ${status}`);
            } else if (healthy > total / 2) {
                showToast(`⚠️ Backend Health: ${status}`);
            } else {
                showToast(`❌ Backend Health: ${status}`);
            }
        }
        
        // Initialize backend integration
        function initBackendIntegration() {
            // Check backend health on startup
            checkBackendHealth();
            
            // Load game content if needed
            loadGameContent();
            
            // Initialize enhanced API features
            initEnhancedAPI();
        }
        
        // Enhanced API utility function with better error handling
        async function apiCall(action, data = {}, options = {}) {
            const { showLoading = false, loadingMessage = 'Processing...', timeout = 10000 } = options;

            let loadingToast = null;
            if (showLoading) {
                loadingToast = showToast(loadingMessage, 'info', 0); // 0 = no auto-hide
            }

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);

                const response = await fetch('api.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action, ...data }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (loadingToast) {
                    hideToast(loadingToast);
                }

                if (!result.success) {
                    throw new Error(result.message || 'Unknown error occurred');
                }

                return result;

            } catch (error) {
                if (loadingToast) {
                    hideToast(loadingToast);
                }

                let errorMessage = 'Connection error. Please check your internet connection.';

                if (error.name === 'AbortError') {
                    errorMessage = 'Request timed out. Please try again.';
                } else if (error.message) {
                    errorMessage = error.message;
                }

                showToast(`❌ ${errorMessage}`, 'error');
                throw error;
            }
        }

        // Enhanced toast function with better control
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#3498db'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 300px;
                word-wrap: break-word;
            `;

            document.body.appendChild(toast);

            if (duration > 0) {
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, duration);
            }

            return toast;
        }

        function hideToast(toast) {
            if (toast && toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }

        // Initialize enhanced API features
        function initEnhancedAPI() {
            // Add leaderboard integration
            if (typeof populateLeaderboard === 'function') {
                // Enhanced leaderboard with backend data
                fetch('api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'get_leaderboard' })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('✅ Leaderboard data loaded from backend');
                    }
                })
                .catch(error => {
                    console.log('⚠️ Leaderboard data not available from backend');
                });
            }
            
            // Add game history integration
            if (typeof showHistory === 'function') {
                // Enhanced history with backend data
                console.log('✅ Game history integration available');
            }
        }
    </script>
</body>

</html>